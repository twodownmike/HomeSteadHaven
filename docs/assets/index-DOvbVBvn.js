import{r as $,z as e,I as U,w as me,J as xe,K as pe,Q as K,X as q,Y as ge,Z as fe,_ as we,p as be,R as re,$ as je}from"./vendor-CvYXfu-e.js";import{c as ye,P as ve,U as ke,S as Se,a as Me,C as Ne,b as Ce,d as Pe,e as Ie,f as Ge,R as Be,X as $e,A as Fe,T as Re,H as ne,g as Ee,h as Le,G as De,M as Oe,W as He,i as ze,E as Ae,B as Te,j as _e,V as We}from"./game-BJa9uRJm.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();const Ue={};function Je(i,l){let s;try{s=i()}catch{return}return{getItem:t=>{var r;const c=a=>a===null?null:JSON.parse(a,void 0),n=(r=s.getItem(t))!=null?r:null;return n instanceof Promise?n.then(c):c(n)},setItem:(t,r)=>s.setItem(t,JSON.stringify(r,void 0)),removeItem:t=>s.removeItem(t)}}const Z=i=>l=>{try{const s=i(l);return s instanceof Promise?s:{then(o){return Z(o)(s)},catch(o){return this}}}catch(s){return{then(o){return this},catch(o){return Z(o)(s)}}}},Ze=(i,l)=>(s,o,t)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:g=>g,version:0,merge:(g,k)=>({...k,...g}),...l},c=!1;const n=new Set,a=new Set;let u;try{u=r.getStorage()}catch{}if(!u)return i((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...g)},o,t);const p=Z(r.serialize),j=()=>{const g=r.partialize({...o()});let k;const h=p({state:g,version:r.version}).then(G=>u.setItem(r.name,G)).catch(G=>{k=G});if(k)throw k;return h},C=t.setState;t.setState=(g,k)=>{C(g,k),j()};const v=i((...g)=>{s(...g),j()},o,t);let w;const b=()=>{var g;if(!u)return;c=!1,n.forEach(h=>h(o()));const k=((g=r.onRehydrateStorage)==null?void 0:g.call(r,o()))||void 0;return Z(u.getItem.bind(u))(r.name).then(h=>{if(h)return r.deserialize(h)}).then(h=>{if(h)if(typeof h.version=="number"&&h.version!==r.version){if(r.migrate)return r.migrate(h.state,h.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return h.state}).then(h=>{var G;return w=r.merge(h,(G=o())!=null?G:v),s(w,!0),j()}).then(()=>{k==null||k(w,void 0),c=!0,a.forEach(h=>h(w))}).catch(h=>{k==null||k(void 0,h)})};return t.persist={setOptions:g=>{r={...r,...g},g.getStorage&&(u=g.getStorage())},clearStorage:()=>{u==null||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>b(),hasHydrated:()=>c,onHydrate:g=>(n.add(g),()=>{n.delete(g)}),onFinishHydration:g=>(a.add(g),()=>{a.delete(g)})},b(),w||v},qe=(i,l)=>(s,o,t)=>{let r={storage:Je(()=>localStorage),partialize:b=>b,version:0,merge:(b,g)=>({...g,...b}),...l},c=!1;const n=new Set,a=new Set;let u=r.storage;if(!u)return i((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...b)},o,t);const p=()=>{const b=r.partialize({...o()});return u.setItem(r.name,{state:b,version:r.version})},j=t.setState;t.setState=(b,g)=>{j(b,g),p()};const C=i((...b)=>{s(...b),p()},o,t);t.getInitialState=()=>C;let v;const w=()=>{var b,g;if(!u)return;c=!1,n.forEach(h=>{var G;return h((G=o())!=null?G:C)});const k=((g=r.onRehydrateStorage)==null?void 0:g.call(r,(b=o())!=null?b:C))||void 0;return Z(u.getItem.bind(u))(r.name).then(h=>{if(h)if(typeof h.version=="number"&&h.version!==r.version){if(r.migrate)return[!0,r.migrate(h.state,h.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,h.state];return[!1,void 0]}).then(h=>{var G;const[y,L]=h;if(v=r.merge(L,(G=o())!=null?G:C),s(v,!0),y)return p()}).then(()=>{k==null||k(v,void 0),v=o(),c=!0,a.forEach(h=>h(v))}).catch(h=>{k==null||k(void 0,h)})};return t.persist={setOptions:b=>{r={...r,...b},b.storage&&(u=b.storage)},clearStorage:()=>{u==null||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>w(),hasHydrated:()=>c,onHydrate:b=>(n.add(b),()=>{n.delete(b)}),onFinishHydration:b=>(a.add(b),()=>{a.delete(b)})},r.skipHydration||w(),v||C},Xe=(i,l)=>"getStorage"in l||"serialize"in l||"deserialize"in l?((Ue?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ze(i,l)):qe(i,l),Ke=Xe,W={cabin:{wood:10},farm:{wood:20,stone:5},lumberMill:{wood:50,stone:10},mine:{wood:100,stone:50},warehouse:{wood:100,stone:20},bakery:{wood:60,stone:20},well:{wood:30,stone:40},campfire:{wood:30,stone:5},watchtower:{wood:80,stone:30},fishery:{wood:40,stone:10}},z={cabin:{housing:4},farm:{workers:1},lumberMill:{workers:2},mine:{workers:3},warehouse:{storage:200},bakery:{workers:2,happiness:.4},well:{happiness:.6},campfire:{housing:1,happiness:1.2},watchtower:{workers:1,happiness:.2},fishery:{workers:1}},ae={cabin:{},farm:{food:5},lumberMill:{wood:5},mine:{stone:2,iron:1},warehouse:{},bakery:{food:8},well:{},campfire:{},watchtower:{},fishery:{food:6}},A=()=>Math.random().toString(36).substr(2,9),_=ye()(Ke((i,l)=>({resources:{wood:100,food:50,stone:0,iron:0},settlers:[{id:"settler-1",name:"John",position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0},{id:"settler-2",name:"Jane",position:[2,0,2],targetPosition:null,state:"idle",actionTimer:0}],happiness:100,buildings:[],nature:(()=>{const s=[];for(let o=0;o<40;o++){const t=Math.random()*Math.PI*2,r=15+Math.random()*30,c=Math.cos(t)*r,n=Math.sin(t)*r,a=Math.random()>.3?"tree":"rock",u=.8+Math.random()*.5;s.push({id:`nature-${o}`,position:[c,0,n],type:a,scale:u})}return s})(),logs:[],weather:"sunny",season:"spring",selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,tickRate:1e3,day:1,objectives:[{id:"obj-wood",title:"Gatherer",description:"Stockpile 150 wood to prove the village can build.",goal:{type:"resource",key:"wood",amount:150},reward:{food:40},complete:!1,claimed:!1},{id:"obj-farm",title:"First Harvest",description:"Build a farm to secure food.",goal:{type:"building",key:"farm",amount:1},reward:{wood:60,food:30},complete:!1,claimed:!1},{id:"obj-pop",title:"New Neighbors",description:"Reach 6 settlers in your homestead.",goal:{type:"population",amount:6},reward:{stone:50,food:50},complete:!1,claimed:!1},{id:"obj-happy",title:"Joyous Village",description:"Raise happiness to 85% or higher.",goal:{type:"happiness",amount:85},reward:{wood:80,iron:20},complete:!1,claimed:!1}],addLog:(s,o="info")=>{i(t=>({logs:[{id:A(),message:s,timestamp:Date.now(),type:o},...t.logs].slice(0,20)}))},addResource:(s,o)=>i(t=>{const n=100+t.buildings.reduce((p,j)=>p+(z[j.type].storage||0)*j.level,0),a=t.resources[s],u=Math.min(a+o,n);return{resources:{...t.resources,[s]:u}}}),removeResource:(s,o)=>l().resources[s]>=o?(i(r=>({resources:{...r.resources,[s]:r.resources[s]-o}})),!0):!1,removeNature:s=>{const o=l(),t=o.nature.find(r=>r.id===s);t&&(o.addLog(`Cleared ${t.type}`,"info"),i(r=>({nature:r.nature.filter(c=>c.id!==s)})))},addBuilding:(s,o)=>{const t=l(),r=t.buildings.some(w=>w.position[0]===o[0]&&w.position[2]===o[2]),c=o[0]-.8,n=o[0]+.8,a=o[2]-.8,u=o[2]+.8,p=t.nature.some(w=>w.position[0]>c&&w.position[0]<n&&w.position[2]>a&&w.position[2]<u);if(r||p){t.addLog("Cannot build here!","warning");return}const j=W[s],C=z[s];let v=!0;if(Object.keys(j).forEach(w=>{(t.resources[w]||0)<(j[w]||0)&&(v=!1)}),!v){t.addLog("Not enough resources!","warning");return}if(C.workers){const w=t.buildings.reduce((b,g)=>b+(z[g.type].workers||0),0);if(t.settlers.length-w<C.workers){v=!1,t.addLog("Not enough workers!","warning");return}}v&&(Object.keys(j).forEach(w=>{t.removeResource(w,j[w]||0)}),i(w=>({buildings:[...w.buildings,{id:A(),type:s,position:o,level:1,lastCollected:Date.now()}],isBuilding:!1,selectedBuilding:null})),t.addLog(`Built ${s}!`,"success"))},upgradeBuilding:s=>{const o=l(),t=o.buildings.find(a=>a.id===s);if(!t)return;const r=W[t.type],c=t.level+1;let n=!0;Object.keys(r).forEach(a=>{const u=(r[a]||0)*c;(o.resources[a]||0)<u&&(n=!1)}),n?(Object.keys(r).forEach(a=>{const u=(r[a]||0)*c;o.removeResource(a,u)}),i(a=>({buildings:a.buildings.map(u=>u.id===s?{...u,level:u.level+1}:u)})),o.addLog(`Upgraded ${t.type} to level ${t.level+1}`,"success")):o.addLog("Not enough resources to upgrade!","warning")},demolishBuilding:s=>{const o=l(),t=o.buildings.find(r=>r.id===s);if(t){o.addLog(`Demolished ${t.type}`,"danger");const r=o.settlers.map(c=>c.job===s?{...c,job:void 0,state:"idle"}:c.home===s?{...c,home:void 0}:c);i(c=>({buildings:c.buildings.filter(n=>n.id!==s),settlers:r,selectedBuildingId:null}))}},assignWorker:s=>{const o=l(),t=o.buildings.find(a=>a.id===s);if(!t)return;const r=z[t.type];if(!r.workers){o.addLog(`${t.type} does not require workers.`,"warning");return}if(o.settlers.filter(a=>a.job===s).length>=(r.workers||0)){o.addLog(`${t.type} is fully staffed.`,"warning");return}const n=o.settlers.find(a=>!a.job);n?(i(a=>({settlers:a.settlers.map(u=>u.id===n.id?{...u,job:s}:u)})),o.addLog(`${n.name} assigned to ${t.type}.`,"success")):o.addLog("No unemployed settlers available.","warning")},unassignWorker:s=>{const o=l(),t=o.settlers.find(r=>r.job===s);t&&(i(r=>({settlers:r.settlers.map(c=>c.id===t.id?{...c,job:void 0,state:"idle"}:c)})),o.addLog(`${t.name} unassigned from job.`,"info"))},setSelectedBuilding:s=>i({selectedBuilding:s,isBuilding:!!s,selectedBuildingId:null}),selectBuildingId:s=>i({selectedBuildingId:s,selectedBuilding:null,isBuilding:!1}),setTickRate:s=>{const o=Math.min(2e3,Math.max(300,s));i({tickRate:o})},celebrateFestival:()=>{const s=l(),o=30,t=40;if(s.resources.wood<o||s.resources.food<t){s.addLog("Not enough supplies for a festival!","warning");return}i(r=>({resources:{...r.resources,wood:r.resources.wood-o,food:r.resources.food-t},happiness:Math.min(100,r.happiness+15)})),s.addLog("You held a lively festival! Happiness soared.","success")},sendExpedition:()=>{const s=l(),o=25,t=15;if(s.resources.food<o||s.resources.wood<t){s.addLog("Not enough supplies to send an expedition.","warning");return}i(n=>({resources:{...n.resources,food:n.resources.food-o,wood:n.resources.wood-t}}));const r=s.buildings.filter(n=>n.type==="watchtower").length,c=Math.random()+r*.05;if(c>.65){const n=40+Math.round(Math.random()*40),a=30+Math.round(Math.random()*30),u=Math.round(Math.random()*30);i(p=>({resources:{...p.resources,wood:p.resources.wood+n,food:p.resources.food+a,stone:p.resources.stone+u},settlers:Math.random()>.6?[...p.settlers,{id:A(),name:`Scout ${p.settlers.length+1}`,position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0}]:p.settlers})),s.addLog(`Expedition returned with riches! +${n} wood, +${a} food${u?`, +${u} stone`:""}`,"success")}else if(c>.35){const n=5+Math.round(Math.random()*10);i(a=>({resources:{...a.resources,iron:a.resources.iron+n}})),s.addLog(`Expedition found rare iron veins! +${n} iron`,"info")}else{const n=Math.max(5,Math.round(s.resources.wood*.05));i(a=>({resources:{...a.resources,wood:Math.max(0,a.resources.wood-n)},happiness:Math.max(0,a.happiness-5)})),s.addLog("Expedition ran into trouble and limped home. Lost some supplies.","danger")}},claimObjective:s=>{const o=l(),t=o.objectives.find(r=>r.id===s);!t||!t.complete||t.claimed||(i(r=>({resources:{...r.resources,wood:r.resources.wood+(t.reward.wood||0),food:r.resources.food+(t.reward.food||0),stone:r.resources.stone+(t.reward.stone||0),iron:r.resources.iron+(t.reward.iron||0)},objectives:r.objectives.map(c=>c.id===s?{...c,claimed:!0}:c)})),o.addLog(`Claimed reward: ${t.title}`,"success"))},tick:()=>{i(s=>{const o={...s.resources};let t=[...s.settlers],r=s.weather,c=s.season,n=[...s.logs];const a=s.buildings.filter(d=>d.type==="well").length,u=s.buildings.filter(d=>d.type==="bakery").length,p=s.buildings.filter(d=>d.type==="campfire").length,j=s.buildings.filter(d=>d.type==="watchtower").length,v=Math.floor(s.day/10)%4,w=["spring","summer","autumn","winter"];if(w[v]!==s.season&&(c=w[v],n=[{id:A(),message:`Season changed to ${c}!`,timestamp:Date.now(),type:"info"},...n].slice(0,20)),Math.random()<.01){const d=Math.random();d<.6?r="sunny":d<.85?r="rain":r="snow",r!==s.weather&&(n=[{id:A(),message:`Weather changed to ${r}!`,timestamp:Date.now(),type:"info"},...n].slice(0,20))}const b=100,g=s.buildings.reduce((d,f)=>d+(z[f.type].storage||0)*f.level,0),k=b+g;let h=s.happiness;const G=s.buildings.reduce((d,f)=>d+(z[f.type].happiness||0)*f.level,0);h=Math.min(100,h+G+p*.4);const y=.5+t.length*.5;if(o.food>=y){if(o.food-=y,h<100&&(h+=.5),o.food>y*2&&h>80&&t.length<s.buildings.reduce((f,S)=>f+(z[S.type].housing||0),2)&&Math.random()<.05){const f=["James","Mary","Robert","Patricia","John","Jennifer","Michael","Linda","David","Elizabeth"],S=f[Math.floor(Math.random()*f.length)];t.push({id:A(),name:S,position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0}),n=[{id:A(),message:`${S} arrived!`,timestamp:Date.now(),type:"success"},...n].slice(0,20)}const d=h/100;s.buildings.forEach(f=>{const S=z[f.type];let D=1;S.workers&&(D=t.filter(R=>R.job===f.id).length/S.workers);const N=D*d,M=ae[f.type];M&&N>0&&Object.keys(M).forEach(F=>{let R=(M[F]||0)*N*f.level;c==="winter"&&(F==="food"&&(R*=.2),f.type==="fishery"&&(R*=.8)),c==="autumn"&&F==="food"&&(R*=1.5),o[F]=Math.min(o[F]+R,k)})}),u>0&&(h=Math.min(100,h+.4*u))}else if(o.food=0,h=Math.max(0,h-10),Math.random()<.1&&t.length>1){const d=Math.floor(Math.random()*t.length),f=t[d];t.splice(d,1),n=[{id:A(),message:`${f.name} died from starvation!`,timestamp:Date.now(),type:"danger"},...n].slice(0,20)}const L=2+s.buildings.reduce((d,f)=>d+(z[f.type].housing||0),0);if(t.length>L&&(h=Math.max(0,h-2)),r==="rain"||r==="snow"){const d=Math.max(0,.1-a*.05-p*.03);h=Math.max(0,h-d)}if(h=Math.min(100,Math.max(0,h)),Math.random()<.008){const d=Math.random();if(d<.33){const f=20+Math.round(Math.random()*20),S=10+Math.round(Math.random()*15);o.wood=Math.min(k,o.wood+f),o.food=Math.min(k,o.food+S),n=[{id:A(),message:`A wandering trader gifted ${f} wood and ${S} food!`,timestamp:Date.now(),type:"success"},...n].slice(0,20)}else if(d<.66){const f=Math.max(5,Math.round(o.wood*.1)),S=Math.max(0,f-a*3-j*5);o.wood=Math.max(0,o.wood-S),h=Math.max(0,h-2),n=[{id:A(),message:`A storm felled trees. Lost ${S} wood, but wells reduced the damage.`,timestamp:Date.now(),type:"warning"},...n].slice(0,20)}else h=Math.min(100,h+5+a),n=[{id:A(),message:"A village festival lifted everyone's spirits! (+Happiness)",timestamp:Date.now(),type:"success"},...n].slice(0,20)}return t=t.map(d=>{const f=s.day%1,S=f>.75||f<.2,D=f>.25&&f<.7;if(d.job&&D){const N=s.buildings.find(M=>M.id===d.job);if(N)return Math.sqrt(Math.pow(d.position[0]-N.position[0],2)+Math.pow(d.position[2]-N.position[2],2))>2?{...d,state:"walking",targetPosition:N.position}:{...d,state:"working",targetPosition:null}}if(S){const N=[0,0,0];return Math.sqrt(Math.pow(d.position[0]-N[0],2)+Math.pow(d.position[2]-N[2],2))>2?{...d,state:"walking",targetPosition:N}:{...d,state:"resting",targetPosition:null}}if(d.state==="idle"||d.state==="working"&&!D||d.state==="resting"&&!S){if(Math.random()<.02){const N=Math.random()*Math.PI*2,M=3+Math.random()*8,F=Math.cos(N)*M,R=Math.sin(N)*M;return{...d,state:"walking",targetPosition:[F,0,R]}}return{...d,state:"idle"}}if(d.state==="walking"&&d.targetPosition){const N=d.targetPosition[0]-d.position[0],M=d.targetPosition[2]-d.position[2],F=Math.sqrt(N*N+M*M),R=.08;return F<R?{...d,position:d.targetPosition,targetPosition:null,state:"idle"}:{...d,position:[d.position[0]+N/F*R,0,d.position[2]+M/F*R]}}return d}),{resources:o,settlers:t,happiness:h,weather:r,season:c,day:s.day+.005,logs:n,tickRate:s.tickRate,objectives:s.objectives.map(d=>{if(d.complete)return d;let f=!1;return d.goal.type==="resource"&&d.goal.key&&d.goal.key in o?f=o[d.goal.key]>=d.goal.amount:d.goal.type==="building"&&d.goal.key?f=s.buildings.filter(S=>S.type===d.goal.key).length>=d.goal.amount:d.goal.type==="population"?f=t.length>=d.goal.amount:d.goal.type==="happiness"&&(f=h>=d.goal.amount),f?{...d,complete:!0}:d})}})},reset:()=>{const s=[];for(let o=0;o<40;o++){const t=Math.random()*Math.PI*2,r=15+Math.random()*30,c=Math.cos(t)*r,n=Math.sin(t)*r,a=Math.random()>.3?"tree":"rock",u=.8+Math.random()*.5;s.push({id:`nature-${o}`,position:[c,0,n],type:a,scale:u})}i({resources:{wood:100,food:50,stone:0,iron:0},settlers:[{id:"settler-1",name:"John",position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0},{id:"settler-2",name:"Jane",position:[2,0,2],targetPosition:null,state:"idle",actionTimer:0}],happiness:100,buildings:[],nature:s,logs:[],weather:"sunny",season:"spring",selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,day:1,tickRate:1e3,objectives:l().objectives.map(o=>({...o,complete:!1,claimed:!1}))})}}),{name:"homestead-storage",partialize:i=>({resources:i.resources,settlers:i.settlers,happiness:i.happiness,buildings:i.buildings,nature:i.nature,logs:i.logs,weather:i.weather,season:i.season,day:i.day,tickRate:i.tickRate,objectives:i.objectives})})),Ye=({type:i})=>{switch(i){case"wood":return e.jsx(ze,{className:"w-4 h-4 text-amber-700"});case"food":return e.jsx(He,{className:"w-4 h-4 text-yellow-600"});case"stone":return e.jsx(ne,{className:"w-4 h-4 text-stone-500"});case"iron":return e.jsx(Oe,{className:"w-4 h-4 text-slate-400"})}},Qe=()=>{const{resources:i,settlers:l,happiness:s,weather:o,isBuilding:t,selectedBuilding:r,setSelectedBuilding:c,day:n,reset:a,season:u,buildings:p,selectedBuildingId:j,selectBuildingId:C,upgradeBuilding:v,demolishBuilding:w,logs:b,tickRate:g,setTickRate:k,objectives:h,claimObjective:G,celebrateFestival:y,sendExpedition:L,assignWorker:d,unassignWorker:f}=_(),[S,D]=$.useState(!1),[N,M]=$.useState(!1),F=m=>{c(r===m&&t?null:m)},R=()=>{confirm("Are you sure you want to reset your progress? This cannot be undone.")&&(a(),D(!1))},B=j?p.find(m=>m.id===j):null,J=B?W[B.type]:null,X=B?B.level+1:1,E=B?z[B.type]:null,ie=B?l.filter(m=>m.job===B.id).length:0,Y=J&&Object.keys(J).every(m=>{const x=m;return i[x]>=(J[x]||0)*X}),le=100,de=p.reduce((m,x)=>m+(z[x.type].storage||0)*x.level,0),Q=le+de,V=i.wood>=30&&i.food>=40,ee=i.food>=25&&i.wood>=15,ce=m=>{const{goal:x}=m;if(x.type==="resource"&&x.key){const P=i[x.key];return Math.min(P/x.amount,1)}if(x.type==="building"&&x.key){const P=p.filter(O=>O.type===x.key).length;return Math.min(P/x.amount,1)}return x.type==="population"?Math.min(l.length/x.amount,1):x.type==="happiness"?Math.min(s/x.amount,1):0},he=m=>{const{goal:x}=m;return x.type==="resource"&&x.key?`${Math.floor(i[x.key])}/${x.amount}`:x.type==="building"&&x.key?`${p.filter(O=>O.type===x.key).length}/${x.amount}`:x.type==="population"?`${l.length}/${x.amount}`:x.type==="happiness"?`${Math.floor(s)}% / ${x.amount}%`:""},se=(E==null?void 0:E.workers)||0,te=se?`${ie}/${se} workers`:"No workers needed",ue=$.useMemo(()=>{const m={};return Object.keys(W).forEach(x=>{const P=z[x],O=ae[x],I=[];P.housing&&I.push(`Housing +${P.housing}`),P.storage&&I.push(`Storage +${P.storage} per level`),P.workers&&I.push(`Needs ${P.workers} worker${P.workers>1?"s":""}`),P.happiness&&I.push(`Happiness +${P.happiness} per level`),O&&Object.entries(O).forEach(([H,T])=>{T&&T>0&&I.push(`Produces ${T}/tick ${H}`)}),x==="campfire"&&I.push("Cozy spot that boosts happiness and eases bad weather."),x==="watchtower"&&I.push("Mitigates storms, improves expeditions."),x==="fishery"&&I.push("Food income even through winter."),x==="well"&&I.push("Reduces rain/snow mood penalty."),x==="bakery"&&I.push("Extra food and morale."),x==="warehouse"&&I.push("Major storage expansion."),m[x]=I}),m},[]);return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-4",children:[e.jsxs("div",{className:"flex justify-between items-start pointer-events-auto",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex gap-4 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:[Object.entries(i).map(([m,x])=>e.jsxs("div",{className:"flex items-center gap-2 min-w-[80px]",children:[e.jsx(Ye,{type:m}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:m}),e.jsx("span",{className:`font-mono font-bold ${x>=Q?"text-red-400":""}`,children:Math.floor(x)})]})]},m)),e.jsxs("div",{className:"border-l border-white/10 pl-4 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Cap"}),e.jsx("span",{className:"font-mono font-bold text-gray-300",children:Q})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl min-w-[80px]",children:[e.jsx(ke,{className:"w-4 h-4 text-blue-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Pop"}),e.jsx("span",{className:"font-mono font-bold",children:l.length})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl min-w-[80px]",children:[e.jsx(Se,{className:`w-4 h-4 ${s>80?"text-green-400":s>40?"text-yellow-400":"text-red-400"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Happy"}),e.jsxs("span",{className:"font-mono font-bold",children:[Math.floor(s),"%"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 items-stretch",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:e.jsxs("div",{className:"text-sm font-bold",children:["Day ",n.toFixed(1)]})}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl flex items-center gap-2",children:[o==="sunny"&&e.jsx(Me,{className:"w-4 h-4 text-yellow-300"}),o==="rain"&&e.jsx(Ne,{className:"w-4 h-4 text-blue-300"}),o==="snow"&&e.jsx(Ce,{className:"w-4 h-4 text-cyan-200"}),e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Weather"}),e.jsx("span",{className:"font-mono font-bold capitalize",children:o})]})]}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl flex flex-col leading-tight",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Season"}),e.jsx("span",{className:"font-mono font-bold capitalize",children:u})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:y,disabled:!V,className:`flex items-center gap-2 px-3 py-2 rounded-xl border text-sm font-semibold transition-colors ${V?"bg-pink-600/30 border-pink-400 text-pink-100 hover:bg-pink-600/50":"bg-white/5 border-white/10 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Pe,{className:"w-4 h-4"}),"Festival"]}),e.jsxs("button",{onClick:L,disabled:!ee,className:`flex items-center gap-2 px-3 py-2 rounded-xl border text-sm font-semibold transition-colors ${ee?"bg-indigo-600/30 border-indigo-400 text-indigo-100 hover:bg-indigo-600/50":"bg-white/5 border-white/10 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Ie,{className:"w-4 h-4"}),"Expedition"]})]}),e.jsx("button",{onClick:()=>D(!S),className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl hover:bg-white/10 transition-colors",children:e.jsx(Ge,{className:"w-5 h-5"})})]})]}),S&&e.jsxs("div",{className:"absolute top-20 right-4 bg-black/80 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl pointer-events-auto z-50 flex flex-col gap-2 min-w-[200px]",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Settings"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Game Speed"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1200,800,500].map(m=>e.jsxs("button",{onClick:()=>k(m),className:`px-3 py-2 rounded-lg text-sm font-semibold border transition-colors ${g===m?"bg-green-600/30 border-green-400 text-green-100":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[Math.round(1e3/m),"x"]},m))}),e.jsx("div",{className:"text-[11px] text-gray-400",children:"Higher speeds update the world more frequently."})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/40 text-red-200 px-4 py-2 rounded-lg transition-colors w-full text-left",children:[e.jsx(Be,{className:"w-4 h-4"}),"Reset Progress"]}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"v0.2.0 Beta"})]}),e.jsx("div",{className:"absolute bottom-32 left-4 flex flex-col gap-2 w-[300px] pointer-events-none opacity-80",children:b.slice(0,5).map(m=>e.jsx("div",{className:`
                    p-2 rounded-lg text-sm font-medium backdrop-blur-md shadow-lg border border-white/5 animate-in slide-in-from-left-4 fade-in duration-300
                    ${m.type==="success"?"bg-green-900/60 text-green-100":m.type==="warning"?"bg-yellow-900/60 text-yellow-100":m.type==="danger"?"bg-red-900/60 text-red-100":"bg-gray-900/60 text-gray-100"}
                `,children:m.message},m.id))}),B&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-md p-6 rounded-2xl border border-white/10 text-white shadow-2xl pointer-events-auto z-40 min-w-[300px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl capitalize",children:B.type}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Level ",B.level]})]}),e.jsx("button",{onClick:()=>C(null),className:"text-gray-400 hover:text-white",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[E&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs bg-white/5 border border-white/10 rounded-xl p-3",children:[E.housing&&e.jsxs("div",{className:"text-gray-200",children:["Housing: +",E.housing]}),E.storage&&e.jsxs("div",{className:"text-gray-200",children:["Storage: +",E.storage*B.level]}),E.happiness&&e.jsxs("div",{className:"text-gray-200",children:["Happiness: +",(E.happiness*B.level).toFixed(1)]}),E.workers!==void 0&&e.jsx("div",{className:"text-gray-200",children:te})]}),(E==null?void 0:E.workers)&&e.jsxs("div",{className:"flex items-center justify-between bg-white/5 border border-white/10 rounded-xl p-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Workers"}),e.jsx("div",{className:"text-gray-300",children:te})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(B.id),className:"px-3 py-2 rounded-lg bg-green-600/30 hover:bg-green-600/50 border border-green-400 text-green-50 text-xs",children:"+ Assign"}),e.jsx("button",{onClick:()=>f(B.id),className:"px-3 py-2 rounded-lg bg-yellow-600/30 hover:bg-yellow-600/50 border border-yellow-400 text-yellow-50 text-xs",children:"- Unassign"})]})]}),e.jsxs("button",{onClick:()=>v(B.id),disabled:!Y,className:`
                flex items-center justify-between p-3 rounded-xl border border-white/10 transition-all
                ${Y?"bg-green-600/20 hover:bg-green-600/40 border-green-500/50":"bg-gray-800/50 opacity-50 cursor-not-allowed"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold",children:"Upgrade"}),e.jsx("div",{className:"text-xs text-gray-300",children:"Increases efficiency"})]})]}),e.jsx("div",{className:"flex flex-col items-end text-xs",children:J&&Object.entries(J).map(([m,x])=>e.jsxs("div",{className:i[m]<x*X?"text-red-400":"text-gray-300",children:[x*X," ",m.charAt(0).toUpperCase()]},m))})]}),e.jsxs("button",{onClick:()=>w(B.id),className:"flex items-center gap-2 p-3 rounded-xl bg-red-500/10 hover:bg-red-500/30 border border-red-500/30 text-red-200 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Demolish Building"]})]})]}),e.jsxs("div",{className:"pointer-events-none w-full px-4 pb-4 flex flex-col gap-3",children:[e.jsx("div",{className:"flex justify-end pointer-events-auto",children:e.jsxs("button",{onClick:()=>M(m=>!m),className:`flex items-center gap-2 px-4 py-2 rounded-full border text-sm font-semibold shadow-lg transition-colors ${N?"bg-yellow-500/20 border-yellow-300 text-yellow-100":"bg-black/60 border-white/10 text-white hover:bg-white/10"}`,children:[e.jsx(ne,{className:"w-4 h-4"}),N?"Close Build":"Build"]})}),N&&e.jsxs("div",{className:"pointer-events-auto mx-auto w-full max-w-5xl bg-black/80 backdrop-blur-md p-4 rounded-2xl border border-white/10 shadow-2xl",children:[t&&r&&e.jsxs("div",{className:"mb-3 bg-yellow-500/15 border border-yellow-400/40 text-yellow-100 px-4 py-2 rounded-lg text-sm font-semibold",children:["Placing ",r,"... tap ground to confirm."]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 max-h-[320px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-white/20",children:Object.keys(W).map(m=>{const x=W[m],P=ue[m]||[],O=r===m,I=Object.keys(x).every(H=>i[H]>=(x[H]||0));return e.jsxs("button",{onClick:()=>F(m),disabled:!I,className:`
                      text-left flex flex-col gap-2 p-3 rounded-xl transition-all duration-200 border
                      ${O?"bg-yellow-600/20 border-yellow-400/60 ring-2 ring-yellow-400/70 text-white":"bg-white/5 border-white/10 hover:bg-white/10 text-gray-200"}
                      ${I?"active:scale-95":"opacity-50 cursor-not-allowed grayscale"}
                    `,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"capitalize font-bold text-base",children:m.replace(/([A-Z])/g," $1").trim()}),e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-white/10 border border-white/10",children:I?"Build":"Need resources"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-gray-200",children:Object.entries(x).map(([H,T])=>e.jsxs("span",{className:`px-2 py-1 rounded-full border ${i[H]<T?"border-red-400/60 text-red-200":"border-white/20 text-white"}`,children:[T," ",H]},H))}),e.jsx("div",{className:"flex flex-col gap-1 text-xs text-gray-300",children:P.length?P.map((H,T)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-white/40 mt-1"}),e.jsx("span",{children:H})]},T)):e.jsx("span",{className:"text-gray-400",children:"No special benefits."})})]},m)})})]}),e.jsxs("div",{className:"pointer-events-auto w-full max-w-4xl bg-black/60 backdrop-blur-md p-4 rounded-2xl border border-white/10 text-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-amber-300"}),e.jsx("h3",{className:"text-lg font-bold",children:"Objectives"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-2",children:h.map(m=>{const x=ce(m),P=he(m),O=m.complete,I=m.claimed;return e.jsxs("div",{className:`p-3 rounded-xl border ${O?"border-green-400/40 bg-green-900/20":"border-white/10 bg-white/5"} shadow-inner`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:m.title}),e.jsx("div",{className:"text-xs text-gray-300",children:m.description})]}),O?e.jsx(Le,{className:"w-5 h-5 text-green-300"}):null]}),e.jsx("div",{className:"mt-2 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${O?"bg-green-400":"bg-blue-400"}`,style:{width:`${x*100}%`}})}),e.jsxs("div",{className:"text-[11px] text-gray-300 mt-1",children:["Progress: ",P]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-200",children:[e.jsx(De,{className:"w-3 h-3"}),Object.entries(m.reward).map(([H,T])=>`${T} ${H[0].toUpperCase()}`).join(", ")]}),O&&!I&&e.jsx("button",{onClick:()=>G(m.id),className:"px-3 py-1 rounded-lg bg-green-600/60 hover:bg-green-600 text-sm font-semibold",children:"Claim"}),I&&e.jsx("span",{className:"text-green-300 text-xs",children:"Claimed"})]})]},m.id)})})]})]})]})},oe=({type:i,level:l=1,selected:s,ghost:o,isValid:t=!0,onClick:r})=>{const c=$.useMemo(()=>{if(o&&!t)return"#ff0000";switch(i){case"cabin":return"#8B4513";case"farm":return"#DAA520";case"lumberMill":return"#556B2F";case"mine":return"#696969";case"warehouse":return"#A0522D";case"bakery":return"#d97706";case"well":return"#3b82f6";case"campfire":return"#f97316";case"watchtower":return"#9ca3af";case"fishery":return"#0ea5e9";default:return"#ffffff"}},[i,o,t]),n=o?.5:1,a=o;return e.jsxs("group",{onClick:r,children:[i!=="farm"&&e.jsxs("mesh",{position:[0,1,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[2,2,2]}),e.jsx("meshStandardMaterial",{color:c,transparent:a,opacity:n})]}),i==="cabin"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,1.2,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[2.2,1.6,2.2]}),e.jsx("meshStandardMaterial",{color:"#8b5a2b",roughness:.8,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,.6,1.11],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.6,1,.1]}),e.jsx("meshStandardMaterial",{color:"#5b3314",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[-.9,1.1,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.1,.6,.6]}),e.jsx("meshStandardMaterial",{color:"#93c5fd",emissive:"#60a5fa",emissiveIntensity:o?0:.4,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[.9,1.1,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.1,.6,.6]}),e.jsx("meshStandardMaterial",{color:"#93c5fd",emissive:"#60a5fa",emissiveIntensity:o?0:.4,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.4,0],rotation:[0,0,Math.PI/9],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.4,.2,2.6]}),e.jsx("meshStandardMaterial",{color:"#4a3424",roughness:.6,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.6,0],rotation:[0,Math.PI,-Math.PI/9],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.4,.2,2.6]}),e.jsx("meshStandardMaterial",{color:"#3b2a1c",roughness:.6,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[.7,2.8,.7],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.4,.8,.4]}),e.jsx("meshStandardMaterial",{color:"#9ca3af",roughness:.4,transparent:a,opacity:n})]})]}),i==="farm"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,.1,0],rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[3,3]}),e.jsx("meshStandardMaterial",{color:"#8b5a2b",transparent:a,opacity:n})]}),[-1,-.3,.4,1.1].map((u,p)=>e.jsxs("mesh",{position:[u,.25,0],receiveShadow:!0,castShadow:!0,children:[e.jsx("boxGeometry",{args:[.4,.2,2.6]}),e.jsx("meshStandardMaterial",{color:"#a16207",roughness:.9,transparent:a,opacity:n})]},p)),Array.from({length:8}).map((u,p)=>{const j=-1.2+p%4*.8,C=-1+Math.floor(p/4)*1.2;return e.jsxs("mesh",{position:[j,.65,C],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.18,.7,6]}),e.jsx("meshStandardMaterial",{color:"#22c55e",emissive:"#16a34a",emissiveIntensity:o?0:.3,transparent:a,opacity:n})]},`crop-${p}`)}),e.jsxs("mesh",{position:[0,1,1.4],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.4,1.2,.8]}),e.jsx("meshStandardMaterial",{color:"#b45309",roughness:.8,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,1.8,1.4],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.6,.3,1]}),e.jsx("meshStandardMaterial",{color:"#92400e",roughness:.7,transparent:a,opacity:n})]}),[[-1.6,-1.6],[1.6,-1.6],[-1.6,1.6],[1.6,1.6]].map(([u,p],j)=>e.jsxs("mesh",{position:[u,.6,p],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.15,1.2,.15]}),e.jsx("meshStandardMaterial",{color:"#d97706",transparent:a,opacity:n})]},`fence-${j}`))]}),i==="mine"&&e.jsxs("mesh",{position:[.8,.5,.8],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"#2F2F2F",transparent:a,opacity:n})]}),i==="lumberMill"&&e.jsxs("mesh",{position:[0,2.2,0],rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.8,.8,2.2,8]}),e.jsx("meshStandardMaterial",{color:"#DEB887",transparent:a,opacity:n})]}),i==="bakery"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.9,.9,1.2,12]}),e.jsx("meshStandardMaterial",{color:"#fbbf24",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[.6,2.9,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.4,.6,6]}),e.jsx("meshStandardMaterial",{color:"#7c2d12",transparent:a,opacity:n})]})]}),i==="well"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,1.1,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.9,.9,1.2,16]}),e.jsx("meshStandardMaterial",{color:"#60a5fa",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,1.7,0],castShadow:!0,children:[e.jsx("torusGeometry",{args:[.8,.12,8,24]}),e.jsx("meshStandardMaterial",{color:"#1d4ed8",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.12,.12,.8,8]}),e.jsx("meshStandardMaterial",{color:"#9ca3af",transparent:a,opacity:n})]})]}),i==="campfire"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,.8,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.6,.7,.4,10]}),e.jsx("meshStandardMaterial",{color:"#92400e",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,1.1,0],children:[e.jsx("coneGeometry",{args:[.5,.6,10]}),e.jsx("meshStandardMaterial",{color:"#f97316",emissive:"#fb923c",emissiveIntensity:o?0:1.2,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,.5,0],rotation:[Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[1,.1,8,24]}),e.jsx("meshStandardMaterial",{color:"#57534e",transparent:a,opacity:n})]})]}),i==="watchtower"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,2,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.7,.7,4,8]}),e.jsx("meshStandardMaterial",{color:"#9ca3af",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,4.2,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.2,.4,2.2]}),e.jsx("meshStandardMaterial",{color:"#4b5563",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,4.8,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1.6,1,6]}),e.jsx("meshStandardMaterial",{color:"#1f2937",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[1,1.2,1],rotation:[0,0,Math.PI/2],children:[e.jsx("boxGeometry",{args:[.2,2,.5]}),e.jsx("meshStandardMaterial",{color:"#d1d5db",transparent:a,opacity:n})]})]}),i==="fishery"&&e.jsxs("group",{children:[e.jsxs("mesh",{position:[0,1,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.5,1.6,2]}),e.jsx("meshStandardMaterial",{color:"#0ea5e9",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.7,.4,2.2]}),e.jsx("meshStandardMaterial",{color:"#075985",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[1.6,.5,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.5,.3,1]}),e.jsx("meshStandardMaterial",{color:"#7c3aed",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,.2,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[3,3]}),e.jsx("meshStandardMaterial",{color:"#38bdf8",transparent:!0,opacity:.3})]})]}),s&&!o&&e.jsxs("mesh",{position:[0,.1,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[1.5,1.7,32]}),e.jsx("meshBasicMaterial",{color:"#00ff00"})]}),!o&&e.jsx(U,{position:[0,3,0],center:!0,distanceFactor:15,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap",children:["Lvl ",l]})})]})},Ve=({id:i,position:l,scale:s=1})=>{const{addResource:o,removeNature:t,isBuilding:r,season:c}=_(),[n,a]=$.useState(!1),[u,p]=$.useState(0),[j,C]=$.useState(0),v=()=>{switch(c){case"spring":return n?"#2e8b2e":"#228B22";case"summer":return n?"#008000":"#006400";case"autumn":return n?"#CD853F":"#D2691E";case"winter":return n?"#F0FFFF":"#E0FFFF";default:return n?"#2e8b2e":"#228B22"}},w=b=>{b.stopPropagation(),o("wood",10),p(Date.now());const g=j+1;C(g),g>=5&&t(i)};return e.jsxs("group",{position:l,scale:[s*(n?1.1:1),s*(n?1.1:1),s*(n?1.1:1)],onPointerOver:()=>a(!0),onPointerOut:()=>a(!1),onClick:w,children:[e.jsxs("mesh",{position:[0,.75,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.2,.3,1.5,6]}),e.jsx("meshStandardMaterial",{color:n?"#6d4c3d":"#5C4033"})]}),e.jsxs("mesh",{position:[0,2,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1,2,8]}),e.jsx("meshStandardMaterial",{color:v()})]}),e.jsxs("mesh",{position:[0,3,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.8,1.5,8]}),e.jsx("meshStandardMaterial",{color:v()})]}),n&&!r&&e.jsx(U,{position:[0,4,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Wood (+10)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-j," more to clear)"]})]})}),Date.now()-u<1e3&&e.jsx(U,{position:[0,2,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-green-400 font-bold text-sm animate-bounce pointer-events-none",children:"+10 Wood"})})]})},es=({id:i,position:l,scale:s=1})=>{const{addResource:o,removeNature:t,isBuilding:r,season:c}=_(),[n,a]=$.useState(!1),[u,p]=$.useState(0),[j,C]=$.useState(0),v=()=>c==="winter"?n?"#cbd5e1":"#e2e8f0":c==="autumn"?n?"#b0a18f":"#8b7c6a":n?"#9ca3af":"#6b7280",w=b=>{b.stopPropagation(),o("stone",5),Math.random()>.7&&o("iron",2),p(Date.now());const g=j+1;C(g),g>=5&&t(i)};return e.jsxs("group",{position:l,scale:[s*(n?1.1:1),s*(n?1.1:1),s*(n?1.1:1)],rotation:[0,Math.random()*Math.PI,0],onPointerOver:()=>a(!0),onPointerOut:()=>a(!1),onClick:w,children:[e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[.8,0]}),e.jsx("meshStandardMaterial",{color:v(),flatShading:!0})]}),n&&!r&&e.jsx(U,{position:[0,1.5,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Stone (+5)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-j," more to clear)"]})]})}),Date.now()-u<1e3&&e.jsx(U,{position:[0,1,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-gray-300 font-bold text-sm animate-bounce pointer-events-none",children:"+5 Stone"})})]})},ss=()=>{const i=_(l=>l.nature);return e.jsx("group",{children:i.map(l=>l.type==="tree"?e.jsx(Ve,{id:l.id,position:l.position,scale:l.scale},l.id):e.jsx(es,{id:l.id,position:l.position,scale:l.scale},l.id))})},ts=({settler:i})=>{const l=$.useRef(null);return me(s=>{l.current&&(l.current.position.y=Math.sin(s.clock.elapsedTime*5)*.1,i.state==="walking"&&i.targetPosition&&l.current.lookAt(i.targetPosition[0],0,i.targetPosition[2]))}),e.jsxs("group",{position:i.position,ref:l,children:[e.jsxs("mesh",{position:[0,.5,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.2,.6,4,8]}),e.jsx("meshStandardMaterial",{color:"#3b82f6"})]}),e.jsxs("mesh",{position:[0,.9,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.2,16,16]}),e.jsx("meshStandardMaterial",{color:"#ffdbac"})]}),e.jsx(U,{position:[0,1.4,0],center:!0,distanceFactor:10,children:e.jsx("div",{className:"bg-black/50 text-white text-[10px] px-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none",children:i.name})}),e.jsxs("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("circleGeometry",{args:[.25,16]}),e.jsx("meshBasicMaterial",{color:"black",opacity:.3,transparent:!0})]})]})},os=()=>{const{buildings:i,nature:l,selectedBuilding:s,selectedBuildingId:o,isBuilding:t,addBuilding:r,selectBuildingId:c,setSelectedBuilding:n,season:a,settlers:u}=_(),[p,j]=$.useState(null),[C,v]=$.useState(!0),w=2,b=()=>{switch(a){case"spring":return"#5C8C46";case"summer":return"#4A7036";case"autumn":return"#8B7355";case"winter":return"#F0F8FF";default:return"#5C8C46"}},g=y=>{if(i.some(M=>M.position[0]===y[0]&&M.position[2]===y[2]))return!0;const d=y[0]-.8,f=y[0]+.8,S=y[2]-.8,D=y[2]+.8;return l.some(M=>M.position[0]>d&&M.position[0]<f&&M.position[2]>S&&M.position[2]<D)},k=y=>{if(!t||!s){p&&j(null);return}const L=Math.round(y.point.x/w)*w,d=Math.round(y.point.z/w)*w,f=[L,0,d];(!p||p[0]!==L||p[2]!==d)&&(j(f),v(!g(f)))},h=y=>{t&&s&&p?(y.stopPropagation(),C&&r(s,p)):(c(null),n(null))},G=(y,L)=>{t||(y.stopPropagation(),c(L))};return e.jsxs("group",{children:[e.jsx(ss,{}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,onPointerMove:k,onClick:h,children:[e.jsx("planeGeometry",{args:[100,100]}),e.jsx("meshStandardMaterial",{color:b()})]}),e.jsx("gridHelper",{args:[100,50,16777215,16777215],position:[0,.01,0],"material-opacity":.2,"material-transparent":!0}),i.map(y=>e.jsx("group",{position:y.position,children:e.jsx(oe,{type:y.type,level:y.level,selected:o===y.id,onClick:L=>G(L,y.id)})},y.id)),u.map(y=>e.jsx(ts,{settler:y},y.id)),t&&s&&p&&e.jsx("group",{position:p,children:e.jsx(oe,{type:s,ghost:!0,isValid:C})})]})},rs=()=>{const i=_(s=>s.tick),l=_(s=>s.tickRate);return $.useEffect(()=>{const s=setInterval(()=>{i()},l);return()=>clearInterval(s)},[i,l]),null},ns=()=>{const{day:i,weather:l}=_(),s=$.useRef(null),o=i%1,t=[Math.sin(o*Math.PI*2)*100,Math.cos(o*Math.PI*2+Math.PI)*100,20],r=t[1]/100;let c=Math.max(0,r);l!=="sunny"&&(c*=.5);const n=Math.max(.1,c*.5);let a=c>.2?"#87CEEB":"#050510";return l==="rain"&&(a="#708090"),l==="snow"&&(a="#E0FFFF"),l!=="sunny"&&c<.2&&(a="#050510"),e.jsxs(e.Fragment,{children:[e.jsx(xe,{sunPosition:t,turbidity:l!=="sunny"?10:.5,rayleigh:l!=="sunny"?.1:.5+(1-c)*.5,mieCoefficient:.005,mieDirectionalG:.7}),c<.2&&l==="sunny"&&e.jsx(pe,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1}),c<.3&&l==="sunny"&&e.jsx(K,{count:100,scale:50,size:4,speed:.4,opacity:.7,color:"#ffff00",position:[0,5,0]}),l==="rain"&&e.jsxs(e.Fragment,{children:[e.jsx(K,{count:2e3,scale:[50,20,50],size:2,speed:2,opacity:.6,color:"#aaaaaa",position:[0,10,0]}),e.jsx(q,{position:[-10,15,-10],opacity:.5,speed:.2}),e.jsx(q,{position:[10,15,10],opacity:.5,speed:.2})]}),l==="snow"&&e.jsxs(e.Fragment,{children:[e.jsx(K,{count:2e3,scale:[50,20,50],size:4,speed:.5,opacity:.8,color:"#ffffff",position:[0,10,0]}),e.jsx(q,{position:[-10,15,-10],opacity:.3,speed:.1,color:"#ffffff"}),e.jsx(q,{position:[10,15,10],opacity:.3,speed:.1,color:"#ffffff"})]}),e.jsx(ge,{preset:l==="sunny"?"forest":"city",background:!1}),e.jsx("ambientLight",{intensity:n,color:l==="snow"?"#E0FFFF":c<.2?"#1a1a2e":"#ffffff"}),e.jsx("directionalLight",{ref:s,position:t,intensity:c*2,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4,children:e.jsx("orthographicCamera",{attach:"shadow-camera",args:[-50,50,50,-50]})}),e.jsx("fog",{attach:"fog",args:[a,10,80]})]})};function as(){return e.jsxs("div",{className:"relative w-full h-full bg-slate-900 touch-none",children:[e.jsx(rs,{}),e.jsx(fe,{shadows:!0,camera:{position:[20,20,20],fov:50},dpr:[1,2],gl:{antialias:!1},children:e.jsxs($.Suspense,{fallback:e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"orange",wireframe:!0})]}),children:[e.jsx(ns,{}),e.jsx(os,{}),e.jsx(we,{makeDefault:!0,maxPolarAngle:Math.PI/2.2,minDistance:10,maxDistance:80,enableDamping:!0,dampingFactor:.05}),e.jsxs(Ae,{children:[e.jsx(Te,{luminanceThreshold:1,mipmapBlur:!0,intensity:.5}),e.jsx(_e,{}),e.jsx(We,{eskil:!1,offset:.1,darkness:.5})]})]})}),e.jsx(Qe,{})]})}console.log("Homestead Survival: Initializing...");console.log("Three.js Revision:",be);class is extends re.Component{constructor(l){super(l),this.state={hasError:!1,error:null}}static getDerivedStateFromError(l){return{hasError:!0,error:l}}componentDidCatch(l,s){console.error("Uncaught error:",l,s)}render(){var l;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-900 text-white p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-4",children:"Something went wrong"}),e.jsx("pre",{className:"bg-black/50 p-4 rounded text-sm overflow-auto max-w-full",children:(l=this.state.error)==null?void 0:l.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700",children:"Reload Game"})]}):this.props.children}}je.createRoot(document.getElementById("root")).render(e.jsx(re.StrictMode,{children:e.jsx(is,{children:e.jsx(as,{})})}));
