import{r as B,z as e,I as z,w as le,J as ce,K as de,Q as Z,X as U,Y as he,Z as ue,_ as me,p as xe,R as se,$ as pe}from"./vendor-CvYXfu-e.js";import{c as ge,P as fe,U as we,S as be,a as je,C as ye,b as ve,d as Se,e as ke,f as Me,R as Ne,X as Ce,A as Ie,T as Pe,g as Ge,h as Fe,G as Be,M as $e,H as Re,W as Ee,i as Le,E as De,B as Oe,j as Ae,V as He}from"./game-BJa9uRJm.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();const ze={};function Te(i,l){let s;try{s=i()}catch{return}return{getItem:t=>{var r;const d=a=>a===null?null:JSON.parse(a,void 0),n=(r=s.getItem(t))!=null?r:null;return n instanceof Promise?n.then(d):d(n)},setItem:(t,r)=>s.setItem(t,JSON.stringify(r,void 0)),removeItem:t=>s.removeItem(t)}}const _=i=>l=>{try{const s=i(l);return s instanceof Promise?s:{then(o){return _(o)(s)},catch(o){return this}}}catch(s){return{then(o){return this},catch(o){return _(o)(s)}}}},_e=(i,l)=>(s,o,t)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:p=>p,version:0,merge:(p,k)=>({...k,...p}),...l},d=!1;const n=new Set,a=new Set;let u;try{u=r.getStorage()}catch{}if(!u)return i((...p)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...p)},o,t);const x=_(r.serialize),j=()=>{const p=r.partialize({...o()});let k;const h=x({state:p,version:r.version}).then(P=>u.setItem(r.name,P)).catch(P=>{k=P});if(k)throw k;return h},C=t.setState;t.setState=(p,k)=>{C(p,k),j()};const S=i((...p)=>{s(...p),j()},o,t);let w;const b=()=>{var p;if(!u)return;d=!1,n.forEach(h=>h(o()));const k=((p=r.onRehydrateStorage)==null?void 0:p.call(r,o()))||void 0;return _(u.getItem.bind(u))(r.name).then(h=>{if(h)return r.deserialize(h)}).then(h=>{if(h)if(typeof h.version=="number"&&h.version!==r.version){if(r.migrate)return r.migrate(h.state,h.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return h.state}).then(h=>{var P;return w=r.merge(h,(P=o())!=null?P:S),s(w,!0),j()}).then(()=>{k==null||k(w,void 0),d=!0,a.forEach(h=>h(w))}).catch(h=>{k==null||k(void 0,h)})};return t.persist={setOptions:p=>{r={...r,...p},p.getStorage&&(u=p.getStorage())},clearStorage:()=>{u==null||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>b(),hasHydrated:()=>d,onHydrate:p=>(n.add(p),()=>{n.delete(p)}),onFinishHydration:p=>(a.add(p),()=>{a.delete(p)})},b(),w||S},We=(i,l)=>(s,o,t)=>{let r={storage:Te(()=>localStorage),partialize:b=>b,version:0,merge:(b,p)=>({...p,...b}),...l},d=!1;const n=new Set,a=new Set;let u=r.storage;if(!u)return i((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...b)},o,t);const x=()=>{const b=r.partialize({...o()});return u.setItem(r.name,{state:b,version:r.version})},j=t.setState;t.setState=(b,p)=>{j(b,p),x()};const C=i((...b)=>{s(...b),x()},o,t);t.getInitialState=()=>C;let S;const w=()=>{var b,p;if(!u)return;d=!1,n.forEach(h=>{var P;return h((P=o())!=null?P:C)});const k=((p=r.onRehydrateStorage)==null?void 0:p.call(r,(b=o())!=null?b:C))||void 0;return _(u.getItem.bind(u))(r.name).then(h=>{if(h)if(typeof h.version=="number"&&h.version!==r.version){if(r.migrate)return[!0,r.migrate(h.state,h.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,h.state];return[!1,void 0]}).then(h=>{var P;const[y,$]=h;if(S=r.merge($,(P=o())!=null?P:C),s(S,!0),y)return x()}).then(()=>{k==null||k(S,void 0),S=o(),d=!0,a.forEach(h=>h(S))}).catch(h=>{k==null||k(void 0,h)})};return t.persist={setOptions:b=>{r={...r,...b},b.storage&&(u=b.storage)},clearStorage:()=>{u==null||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>w(),hasHydrated:()=>d,onHydrate:b=>(n.add(b),()=>{n.delete(b)}),onFinishHydration:b=>(a.add(b),()=>{a.delete(b)})},r.skipHydration||w(),S||C},Ue=(i,l)=>"getStorage"in l||"serialize"in l||"deserialize"in l?((ze?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),_e(i,l)):We(i,l),Je=Ue,T={cabin:{wood:10},farm:{wood:20,stone:5},lumberMill:{wood:50,stone:10},mine:{wood:100,stone:50},warehouse:{wood:100,stone:20},bakery:{wood:60,stone:20},well:{wood:30,stone:40},campfire:{wood:30,stone:5},watchtower:{wood:80,stone:30},fishery:{wood:40,stone:10}},D={cabin:{housing:4},farm:{workers:1},lumberMill:{workers:2},mine:{workers:3},warehouse:{storage:200},bakery:{workers:2,happiness:.4},well:{happiness:.6},campfire:{housing:1,happiness:1.2},watchtower:{workers:1,happiness:.2},fishery:{workers:1}},Ze={cabin:{},farm:{food:5},lumberMill:{wood:5},mine:{stone:2,iron:1},warehouse:{},bakery:{food:8},well:{},campfire:{},watchtower:{},fishery:{food:6}},L=()=>Math.random().toString(36).substr(2,9),H=ge()(Je((i,l)=>({resources:{wood:100,food:50,stone:0,iron:0},settlers:[{id:"settler-1",name:"John",position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0},{id:"settler-2",name:"Jane",position:[2,0,2],targetPosition:null,state:"idle",actionTimer:0}],happiness:100,buildings:[],nature:(()=>{const s=[];for(let o=0;o<40;o++){const t=Math.random()*Math.PI*2,r=15+Math.random()*30,d=Math.cos(t)*r,n=Math.sin(t)*r,a=Math.random()>.3?"tree":"rock",u=.8+Math.random()*.5;s.push({id:`nature-${o}`,position:[d,0,n],type:a,scale:u})}return s})(),logs:[],weather:"sunny",season:"spring",selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,tickRate:1e3,day:1,objectives:[{id:"obj-wood",title:"Gatherer",description:"Stockpile 150 wood to prove the village can build.",goal:{type:"resource",key:"wood",amount:150},reward:{food:40},complete:!1,claimed:!1},{id:"obj-farm",title:"First Harvest",description:"Build a farm to secure food.",goal:{type:"building",key:"farm",amount:1},reward:{wood:60,food:30},complete:!1,claimed:!1},{id:"obj-pop",title:"New Neighbors",description:"Reach 6 settlers in your homestead.",goal:{type:"population",amount:6},reward:{stone:50,food:50},complete:!1,claimed:!1},{id:"obj-happy",title:"Joyous Village",description:"Raise happiness to 85% or higher.",goal:{type:"happiness",amount:85},reward:{wood:80,iron:20},complete:!1,claimed:!1}],addLog:(s,o="info")=>{i(t=>({logs:[{id:L(),message:s,timestamp:Date.now(),type:o},...t.logs].slice(0,20)}))},addResource:(s,o)=>i(t=>{const n=100+t.buildings.reduce((x,j)=>x+(D[j.type].storage||0)*j.level,0),a=t.resources[s],u=Math.min(a+o,n);return{resources:{...t.resources,[s]:u}}}),removeResource:(s,o)=>l().resources[s]>=o?(i(r=>({resources:{...r.resources,[s]:r.resources[s]-o}})),!0):!1,removeNature:s=>{const o=l(),t=o.nature.find(r=>r.id===s);t&&(o.addLog(`Cleared ${t.type}`,"info"),i(r=>({nature:r.nature.filter(d=>d.id!==s)})))},addBuilding:(s,o)=>{const t=l(),r=t.buildings.some(w=>w.position[0]===o[0]&&w.position[2]===o[2]),d=o[0]-.8,n=o[0]+.8,a=o[2]-.8,u=o[2]+.8,x=t.nature.some(w=>w.position[0]>d&&w.position[0]<n&&w.position[2]>a&&w.position[2]<u);if(r||x){t.addLog("Cannot build here!","warning");return}const j=T[s],C=D[s];let S=!0;if(Object.keys(j).forEach(w=>{(t.resources[w]||0)<(j[w]||0)&&(S=!1)}),!S){t.addLog("Not enough resources!","warning");return}if(C.workers){const w=t.buildings.reduce((b,p)=>b+(D[p.type].workers||0),0);if(t.settlers.length-w<C.workers){S=!1,t.addLog("Not enough workers!","warning");return}}S&&(Object.keys(j).forEach(w=>{t.removeResource(w,j[w]||0)}),i(w=>({buildings:[...w.buildings,{id:L(),type:s,position:o,level:1,lastCollected:Date.now()}],isBuilding:!1,selectedBuilding:null})),t.addLog(`Built ${s}!`,"success"))},upgradeBuilding:s=>{const o=l(),t=o.buildings.find(a=>a.id===s);if(!t)return;const r=T[t.type],d=t.level+1;let n=!0;Object.keys(r).forEach(a=>{const u=(r[a]||0)*d;(o.resources[a]||0)<u&&(n=!1)}),n?(Object.keys(r).forEach(a=>{const u=(r[a]||0)*d;o.removeResource(a,u)}),i(a=>({buildings:a.buildings.map(u=>u.id===s?{...u,level:u.level+1}:u)})),o.addLog(`Upgraded ${t.type} to level ${t.level+1}`,"success")):o.addLog("Not enough resources to upgrade!","warning")},demolishBuilding:s=>{const o=l(),t=o.buildings.find(r=>r.id===s);if(t){o.addLog(`Demolished ${t.type}`,"danger");const r=o.settlers.map(d=>d.job===s?{...d,job:void 0,state:"idle"}:d.home===s?{...d,home:void 0}:d);i(d=>({buildings:d.buildings.filter(n=>n.id!==s),settlers:r,selectedBuildingId:null}))}},assignWorker:s=>{const o=l(),t=o.buildings.find(a=>a.id===s);if(!t)return;const r=D[t.type];if(!r.workers){o.addLog(`${t.type} does not require workers.`,"warning");return}if(o.settlers.filter(a=>a.job===s).length>=(r.workers||0)){o.addLog(`${t.type} is fully staffed.`,"warning");return}const n=o.settlers.find(a=>!a.job);n?(i(a=>({settlers:a.settlers.map(u=>u.id===n.id?{...u,job:s}:u)})),o.addLog(`${n.name} assigned to ${t.type}.`,"success")):o.addLog("No unemployed settlers available.","warning")},unassignWorker:s=>{const o=l(),t=o.settlers.find(r=>r.job===s);t&&(i(r=>({settlers:r.settlers.map(d=>d.id===t.id?{...d,job:void 0,state:"idle"}:d)})),o.addLog(`${t.name} unassigned from job.`,"info"))},setSelectedBuilding:s=>i({selectedBuilding:s,isBuilding:!!s,selectedBuildingId:null}),selectBuildingId:s=>i({selectedBuildingId:s,selectedBuilding:null,isBuilding:!1}),setTickRate:s=>{const o=Math.min(2e3,Math.max(300,s));i({tickRate:o})},celebrateFestival:()=>{const s=l(),o=30,t=40;if(s.resources.wood<o||s.resources.food<t){s.addLog("Not enough supplies for a festival!","warning");return}i(r=>({resources:{...r.resources,wood:r.resources.wood-o,food:r.resources.food-t},happiness:Math.min(100,r.happiness+15)})),s.addLog("You held a lively festival! Happiness soared.","success")},sendExpedition:()=>{const s=l(),o=25,t=15;if(s.resources.food<o||s.resources.wood<t){s.addLog("Not enough supplies to send an expedition.","warning");return}i(n=>({resources:{...n.resources,food:n.resources.food-o,wood:n.resources.wood-t}}));const r=s.buildings.filter(n=>n.type==="watchtower").length,d=Math.random()+r*.05;if(d>.65){const n=40+Math.round(Math.random()*40),a=30+Math.round(Math.random()*30),u=Math.round(Math.random()*30);i(x=>({resources:{...x.resources,wood:x.resources.wood+n,food:x.resources.food+a,stone:x.resources.stone+u},settlers:Math.random()>.6?[...x.settlers,{id:L(),name:`Scout ${x.settlers.length+1}`,position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0}]:x.settlers})),s.addLog(`Expedition returned with riches! +${n} wood, +${a} food${u?`, +${u} stone`:""}`,"success")}else if(d>.35){const n=5+Math.round(Math.random()*10);i(a=>({resources:{...a.resources,iron:a.resources.iron+n}})),s.addLog(`Expedition found rare iron veins! +${n} iron`,"info")}else{const n=Math.max(5,Math.round(s.resources.wood*.05));i(a=>({resources:{...a.resources,wood:Math.max(0,a.resources.wood-n)},happiness:Math.max(0,a.happiness-5)})),s.addLog("Expedition ran into trouble and limped home. Lost some supplies.","danger")}},claimObjective:s=>{const o=l(),t=o.objectives.find(r=>r.id===s);!t||!t.complete||t.claimed||(i(r=>({resources:{...r.resources,wood:r.resources.wood+(t.reward.wood||0),food:r.resources.food+(t.reward.food||0),stone:r.resources.stone+(t.reward.stone||0),iron:r.resources.iron+(t.reward.iron||0)},objectives:r.objectives.map(d=>d.id===s?{...d,claimed:!0}:d)})),o.addLog(`Claimed reward: ${t.title}`,"success"))},tick:()=>{i(s=>{const o={...s.resources};let t=[...s.settlers],r=s.weather,d=s.season,n=[...s.logs];const a=s.buildings.filter(c=>c.type==="well").length,u=s.buildings.filter(c=>c.type==="bakery").length,x=s.buildings.filter(c=>c.type==="campfire").length,j=s.buildings.filter(c=>c.type==="watchtower").length,S=Math.floor(s.day/10)%4,w=["spring","summer","autumn","winter"];if(w[S]!==s.season&&(d=w[S],n=[{id:L(),message:`Season changed to ${d}!`,timestamp:Date.now(),type:"info"},...n].slice(0,20)),Math.random()<.01){const c=Math.random();c<.6?r="sunny":c<.85?r="rain":r="snow",r!==s.weather&&(n=[{id:L(),message:`Weather changed to ${r}!`,timestamp:Date.now(),type:"info"},...n].slice(0,20))}const b=100,p=s.buildings.reduce((c,g)=>c+(D[g.type].storage||0)*g.level,0),k=b+p;let h=s.happiness;const P=s.buildings.reduce((c,g)=>c+(D[g.type].happiness||0)*g.level,0);h=Math.min(100,h+P+x*.4);const y=.5+t.length*.5;if(o.food>=y){if(o.food-=y,h<100&&(h+=.5),o.food>y*2&&h>80&&t.length<s.buildings.reduce((g,M)=>g+(D[M.type].housing||0),2)&&Math.random()<.05){const g=["James","Mary","Robert","Patricia","John","Jennifer","Michael","Linda","David","Elizabeth"],M=g[Math.floor(Math.random()*g.length)];t.push({id:L(),name:M,position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0}),n=[{id:L(),message:`${M} arrived!`,timestamp:Date.now(),type:"success"},...n].slice(0,20)}const c=h/100;s.buildings.forEach(g=>{const M=D[g.type];let R=1;M.workers&&(R=t.filter(G=>G.job===g.id).length/M.workers);const I=R*c,N=Ze[g.type];N&&I>0&&Object.keys(N).forEach(v=>{let G=(N[v]||0)*I*g.level;d==="winter"&&(v==="food"&&(G*=.2),g.type==="fishery"&&(G*=.8)),d==="autumn"&&v==="food"&&(G*=1.5),o[v]=Math.min(o[v]+G,k)})}),u>0&&(h=Math.min(100,h+.4*u))}else if(o.food=0,h=Math.max(0,h-10),Math.random()<.1&&t.length>1){const c=Math.floor(Math.random()*t.length),g=t[c];t.splice(c,1),n=[{id:L(),message:`${g.name} died from starvation!`,timestamp:Date.now(),type:"danger"},...n].slice(0,20)}const $=2+s.buildings.reduce((c,g)=>c+(D[g.type].housing||0),0);if(t.length>$&&(h=Math.max(0,h-2)),r==="rain"||r==="snow"){const c=Math.max(0,.1-a*.05-x*.03);h=Math.max(0,h-c)}if(h=Math.min(100,Math.max(0,h)),Math.random()<.008){const c=Math.random();if(c<.33){const g=20+Math.round(Math.random()*20),M=10+Math.round(Math.random()*15);o.wood=Math.min(k,o.wood+g),o.food=Math.min(k,o.food+M),n=[{id:L(),message:`A wandering trader gifted ${g} wood and ${M} food!`,timestamp:Date.now(),type:"success"},...n].slice(0,20)}else if(c<.66){const g=Math.max(5,Math.round(o.wood*.1)),M=Math.max(0,g-a*3-j*5);o.wood=Math.max(0,o.wood-M),h=Math.max(0,h-2),n=[{id:L(),message:`A storm felled trees. Lost ${M} wood, but wells reduced the damage.`,timestamp:Date.now(),type:"warning"},...n].slice(0,20)}else h=Math.min(100,h+5+a),n=[{id:L(),message:"A village festival lifted everyone's spirits! (+Happiness)",timestamp:Date.now(),type:"success"},...n].slice(0,20)}return t=t.map(c=>{const g=s.day%1,M=g>.75||g<.2,R=g>.25&&g<.7;if(c.job&&R){const I=s.buildings.find(N=>N.id===c.job);if(I)return Math.sqrt(Math.pow(c.position[0]-I.position[0],2)+Math.pow(c.position[2]-I.position[2],2))>2?{...c,state:"walking",targetPosition:I.position}:{...c,state:"working",targetPosition:null}}if(M){const I=[0,0,0];return Math.sqrt(Math.pow(c.position[0]-I[0],2)+Math.pow(c.position[2]-I[2],2))>2?{...c,state:"walking",targetPosition:I}:{...c,state:"resting",targetPosition:null}}if(c.state==="idle"||c.state==="working"&&!R||c.state==="resting"&&!M){if(Math.random()<.02){const I=Math.random()*Math.PI*2,N=3+Math.random()*8,v=Math.cos(I)*N,G=Math.sin(I)*N;return{...c,state:"walking",targetPosition:[v,0,G]}}return{...c,state:"idle"}}if(c.state==="walking"&&c.targetPosition){const I=c.targetPosition[0]-c.position[0],N=c.targetPosition[2]-c.position[2],v=Math.sqrt(I*I+N*N),G=.08;return v<G?{...c,position:c.targetPosition,targetPosition:null,state:"idle"}:{...c,position:[c.position[0]+I/v*G,0,c.position[2]+N/v*G]}}return c}),{resources:o,settlers:t,happiness:h,weather:r,season:d,day:s.day+.005,logs:n,tickRate:s.tickRate,objectives:s.objectives.map(c=>{if(c.complete)return c;let g=!1;return c.goal.type==="resource"&&c.goal.key&&c.goal.key in o?g=o[c.goal.key]>=c.goal.amount:c.goal.type==="building"&&c.goal.key?g=s.buildings.filter(M=>M.type===c.goal.key).length>=c.goal.amount:c.goal.type==="population"?g=t.length>=c.goal.amount:c.goal.type==="happiness"&&(g=h>=c.goal.amount),g?{...c,complete:!0}:c})}})},reset:()=>{const s=[];for(let o=0;o<40;o++){const t=Math.random()*Math.PI*2,r=15+Math.random()*30,d=Math.cos(t)*r,n=Math.sin(t)*r,a=Math.random()>.3?"tree":"rock",u=.8+Math.random()*.5;s.push({id:`nature-${o}`,position:[d,0,n],type:a,scale:u})}i({resources:{wood:100,food:50,stone:0,iron:0},settlers:[{id:"settler-1",name:"John",position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0},{id:"settler-2",name:"Jane",position:[2,0,2],targetPosition:null,state:"idle",actionTimer:0}],happiness:100,buildings:[],nature:s,logs:[],weather:"sunny",season:"spring",selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,day:1,tickRate:1e3,objectives:l().objectives.map(o=>({...o,complete:!1,claimed:!1}))})}}),{name:"homestead-storage",partialize:i=>({resources:i.resources,settlers:i.settlers,happiness:i.happiness,buildings:i.buildings,nature:i.nature,logs:i.logs,weather:i.weather,season:i.season,day:i.day,tickRate:i.tickRate,objectives:i.objectives})})),qe=({type:i})=>{switch(i){case"wood":return e.jsx(Le,{className:"w-4 h-4 text-amber-700"});case"food":return e.jsx(Ee,{className:"w-4 h-4 text-yellow-600"});case"stone":return e.jsx(Re,{className:"w-4 h-4 text-stone-500"});case"iron":return e.jsx($e,{className:"w-4 h-4 text-slate-400"})}},Xe=()=>{const{resources:i,settlers:l,happiness:s,weather:o,isBuilding:t,selectedBuilding:r,setSelectedBuilding:d,day:n,reset:a,season:u,buildings:x,selectedBuildingId:j,selectBuildingId:C,upgradeBuilding:S,demolishBuilding:w,logs:b,tickRate:p,setTickRate:k,objectives:h,claimObjective:P,celebrateFestival:y,sendExpedition:$,assignWorker:c,unassignWorker:g}=H(),[M,R]=B.useState(!1),I=m=>{d(r===m&&t?null:m)},N=()=>{confirm("Are you sure you want to reset your progress? This cannot be undone.")&&(a(),R(!1))},v=j?x.find(m=>m.id===j):null,G=v?T[v.type]:null,J=v?v.level+1:1,F=v?D[v.type]:null,te=v?l.filter(m=>m.job===v.id).length:0,q=G&&Object.keys(G).every(m=>{const f=m;return i[f]>=(G[f]||0)*J}),oe=100,re=x.reduce((m,f)=>m+(D[f.type].storage||0)*f.level,0),X=oe+re,K=i.wood>=30&&i.food>=40,Y=i.food>=25&&i.wood>=15,ne=m=>{const{goal:f}=m;if(f.type==="resource"&&f.key){const O=i[f.key];return Math.min(O/f.amount,1)}if(f.type==="building"&&f.key){const O=x.filter(E=>E.type===f.key).length;return Math.min(O/f.amount,1)}return f.type==="population"?Math.min(l.length/f.amount,1):f.type==="happiness"?Math.min(s/f.amount,1):0},ae=m=>{const{goal:f}=m;return f.type==="resource"&&f.key?`${Math.floor(i[f.key])}/${f.amount}`:f.type==="building"&&f.key?`${x.filter(E=>E.type===f.key).length}/${f.amount}`:f.type==="population"?`${l.length}/${f.amount}`:f.type==="happiness"?`${Math.floor(s)}% / ${f.amount}%`:""},Q=(F==null?void 0:F.workers)||0,V=Q?`${te}/${Q} workers`:"No workers needed";return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-4",children:[e.jsxs("div",{className:"flex justify-between items-start pointer-events-auto",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex gap-4 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:[Object.entries(i).map(([m,f])=>e.jsxs("div",{className:"flex items-center gap-2 min-w-[80px]",children:[e.jsx(qe,{type:m}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:m}),e.jsx("span",{className:`font-mono font-bold ${f>=X?"text-red-400":""}`,children:Math.floor(f)})]})]},m)),e.jsxs("div",{className:"border-l border-white/10 pl-4 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Cap"}),e.jsx("span",{className:"font-mono font-bold text-gray-300",children:X})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl min-w-[80px]",children:[e.jsx(we,{className:"w-4 h-4 text-blue-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Pop"}),e.jsx("span",{className:"font-mono font-bold",children:l.length})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl min-w-[80px]",children:[e.jsx(be,{className:`w-4 h-4 ${s>80?"text-green-400":s>40?"text-yellow-400":"text-red-400"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Happy"}),e.jsxs("span",{className:"font-mono font-bold",children:[Math.floor(s),"%"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 items-stretch",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:e.jsxs("div",{className:"text-sm font-bold",children:["Day ",n.toFixed(1)]})}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl flex items-center gap-2",children:[o==="sunny"&&e.jsx(je,{className:"w-4 h-4 text-yellow-300"}),o==="rain"&&e.jsx(ye,{className:"w-4 h-4 text-blue-300"}),o==="snow"&&e.jsx(ve,{className:"w-4 h-4 text-cyan-200"}),e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Weather"}),e.jsx("span",{className:"font-mono font-bold capitalize",children:o})]})]}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl flex flex-col leading-tight",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Season"}),e.jsx("span",{className:"font-mono font-bold capitalize",children:u})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:y,disabled:!K,className:`flex items-center gap-2 px-3 py-2 rounded-xl border text-sm font-semibold transition-colors ${K?"bg-pink-600/30 border-pink-400 text-pink-100 hover:bg-pink-600/50":"bg-white/5 border-white/10 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Se,{className:"w-4 h-4"}),"Festival"]}),e.jsxs("button",{onClick:$,disabled:!Y,className:`flex items-center gap-2 px-3 py-2 rounded-xl border text-sm font-semibold transition-colors ${Y?"bg-indigo-600/30 border-indigo-400 text-indigo-100 hover:bg-indigo-600/50":"bg-white/5 border-white/10 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(ke,{className:"w-4 h-4"}),"Expedition"]})]}),e.jsx("button",{onClick:()=>R(!M),className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl hover:bg-white/10 transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]})]}),M&&e.jsxs("div",{className:"absolute top-20 right-4 bg-black/80 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl pointer-events-auto z-50 flex flex-col gap-2 min-w-[200px]",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Settings"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Game Speed"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1200,800,500].map(m=>e.jsxs("button",{onClick:()=>k(m),className:`px-3 py-2 rounded-lg text-sm font-semibold border transition-colors ${p===m?"bg-green-600/30 border-green-400 text-green-100":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[Math.round(1e3/m),"x"]},m))}),e.jsx("div",{className:"text-[11px] text-gray-400",children:"Higher speeds update the world more frequently."})]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/40 text-red-200 px-4 py-2 rounded-lg transition-colors w-full text-left",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Reset Progress"]}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"v0.2.0 Beta"})]}),e.jsx("div",{className:"absolute bottom-32 left-4 flex flex-col gap-2 w-[300px] pointer-events-none opacity-80",children:b.slice(0,5).map(m=>e.jsx("div",{className:`
                    p-2 rounded-lg text-sm font-medium backdrop-blur-md shadow-lg border border-white/5 animate-in slide-in-from-left-4 fade-in duration-300
                    ${m.type==="success"?"bg-green-900/60 text-green-100":m.type==="warning"?"bg-yellow-900/60 text-yellow-100":m.type==="danger"?"bg-red-900/60 text-red-100":"bg-gray-900/60 text-gray-100"}
                `,children:m.message},m.id))}),v&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-md p-6 rounded-2xl border border-white/10 text-white shadow-2xl pointer-events-auto z-40 min-w-[300px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl capitalize",children:v.type}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Level ",v.level]})]}),e.jsx("button",{onClick:()=>C(null),className:"text-gray-400 hover:text-white",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[F&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs bg-white/5 border border-white/10 rounded-xl p-3",children:[F.housing&&e.jsxs("div",{className:"text-gray-200",children:["Housing: +",F.housing]}),F.storage&&e.jsxs("div",{className:"text-gray-200",children:["Storage: +",F.storage*v.level]}),F.happiness&&e.jsxs("div",{className:"text-gray-200",children:["Happiness: +",(F.happiness*v.level).toFixed(1)]}),F.workers!==void 0&&e.jsx("div",{className:"text-gray-200",children:V})]}),(F==null?void 0:F.workers)&&e.jsxs("div",{className:"flex items-center justify-between bg-white/5 border border-white/10 rounded-xl p-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Workers"}),e.jsx("div",{className:"text-gray-300",children:V})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(v.id),className:"px-3 py-2 rounded-lg bg-green-600/30 hover:bg-green-600/50 border border-green-400 text-green-50 text-xs",children:"+ Assign"}),e.jsx("button",{onClick:()=>g(v.id),className:"px-3 py-2 rounded-lg bg-yellow-600/30 hover:bg-yellow-600/50 border border-yellow-400 text-yellow-50 text-xs",children:"- Unassign"})]})]}),e.jsxs("button",{onClick:()=>S(v.id),disabled:!q,className:`
                          flex items-center justify-between p-3 rounded-xl border border-white/10 transition-all
                          ${q?"bg-green-600/20 hover:bg-green-600/40 border-green-500/50":"bg-gray-800/50 opacity-50 cursor-not-allowed"}
                      `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold",children:"Upgrade"}),e.jsx("div",{className:"text-xs text-gray-300",children:"Increases efficiency"})]})]}),e.jsx("div",{className:"flex flex-col items-end text-xs",children:G&&Object.entries(G).map(([m,f])=>e.jsxs("div",{className:i[m]<f*J?"text-red-400":"text-gray-300",children:[f*J," ",m.charAt(0).toUpperCase()]},m))})]}),e.jsxs("button",{onClick:()=>w(v.id),className:"flex items-center gap-2 p-3 rounded-xl bg-red-500/10 hover:bg-red-500/30 border border-red-500/30 text-red-200 transition-colors",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Demolish Building"]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4 pointer-events-auto mb-4 w-full px-4",children:[t&&e.jsxs("div",{className:"bg-black/80 text-white px-6 py-3 rounded-full text-base animate-pulse border border-yellow-500/50 shadow-lg",children:["Placing ",r,"... (Tap to build)"]}),e.jsx("div",{className:"flex gap-3 bg-black/80 backdrop-blur-md p-3 rounded-2xl border border-white/10 shadow-2xl overflow-x-auto w-full max-w-full scrollbar-hide",children:Object.keys(T).map(m=>{const f=T[m],O=r===m,E=Object.keys(f).every(A=>i[A]>=(f[A]||0));return e.jsxs("button",{onClick:()=>I(m),disabled:!E,className:`
                  relative group flex flex-col items-center gap-2 p-4 rounded-xl transition-all duration-200 min-w-[110px] flex-shrink-0
                  ${O?"bg-yellow-600 text-white ring-2 ring-yellow-400":"bg-white/5 hover:bg-white/10 text-gray-300"}
                  ${E?"active:scale-95":"opacity-50 cursor-not-allowed grayscale"}
                `,children:[e.jsx("span",{className:"capitalize font-bold text-sm md:text-base",children:m.replace(/([A-Z])/g," $1").trim()}),e.jsx("div",{className:"flex gap-2 text-xs",children:Object.entries(f).map(([A,W])=>e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:i[A]<W?"text-red-400":"text-gray-400",children:[W," ",A.charAt(0).toUpperCase()]})},A))})]},m)})})]}),e.jsxs("div",{className:"w-full max-w-4xl flex flex-col gap-2 bg-black/60 backdrop-blur-md p-4 rounded-2xl border border-white/10 text-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-amber-300"}),e.jsx("h3",{className:"text-lg font-bold",children:"Objectives"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.map(m=>{const f=ne(m),O=ae(m),E=m.complete,A=m.claimed;return e.jsxs("div",{className:`p-3 rounded-xl border ${E?"border-green-400/40 bg-green-900/20":"border-white/10 bg-white/5"} shadow-inner`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:m.title}),e.jsx("div",{className:"text-xs text-gray-300",children:m.description})]}),E?e.jsx(Fe,{className:"w-5 h-5 text-green-300"}):null]}),e.jsx("div",{className:"mt-2 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${E?"bg-green-400":"bg-blue-400"}`,style:{width:`${f*100}%`}})}),e.jsxs("div",{className:"text-[11px] text-gray-300 mt-1",children:["Progress: ",O]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-200",children:[e.jsx(Be,{className:"w-3 h-3"}),Object.entries(m.reward).map(([W,ie])=>`${ie} ${W[0].toUpperCase()}`).join(", ")]}),E&&!A&&e.jsx("button",{onClick:()=>P(m.id),className:"px-3 py-1 rounded-lg bg-green-600/60 hover:bg-green-600 text-sm font-semibold",children:"Claim"}),A&&e.jsx("span",{className:"text-green-300 text-xs",children:"Claimed"})]})]},m.id)})})]})]})},ee=({type:i,level:l=1,selected:s,ghost:o,isValid:t=!0,onClick:r})=>{const d=B.useMemo(()=>{if(o&&!t)return"#ff0000";switch(i){case"cabin":return"#8B4513";case"farm":return"#DAA520";case"lumberMill":return"#556B2F";case"mine":return"#696969";case"warehouse":return"#A0522D";case"bakery":return"#d97706";case"well":return"#3b82f6";case"campfire":return"#f97316";case"watchtower":return"#9ca3af";case"fishery":return"#0ea5e9";default:return"#ffffff"}},[i,o,t]),n=o?.5:1,a=o;return e.jsxs("group",{onClick:r,children:[i!=="farm"&&e.jsxs("mesh",{position:[0,1,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[2,2,2]}),e.jsx("meshStandardMaterial",{color:d,transparent:a,opacity:n})]}),i==="cabin"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,1.2,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[2.2,1.6,2.2]}),e.jsx("meshStandardMaterial",{color:"#8b5a2b",roughness:.8,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,.6,1.11],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.6,1,.1]}),e.jsx("meshStandardMaterial",{color:"#5b3314",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[-.9,1.1,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.1,.6,.6]}),e.jsx("meshStandardMaterial",{color:"#93c5fd",emissive:"#60a5fa",emissiveIntensity:o?0:.4,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[.9,1.1,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.1,.6,.6]}),e.jsx("meshStandardMaterial",{color:"#93c5fd",emissive:"#60a5fa",emissiveIntensity:o?0:.4,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.4,0],rotation:[0,0,Math.PI/9],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.4,.2,2.6]}),e.jsx("meshStandardMaterial",{color:"#4a3424",roughness:.6,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.6,0],rotation:[0,Math.PI,-Math.PI/9],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.4,.2,2.6]}),e.jsx("meshStandardMaterial",{color:"#3b2a1c",roughness:.6,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[.7,2.8,.7],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.4,.8,.4]}),e.jsx("meshStandardMaterial",{color:"#9ca3af",roughness:.4,transparent:a,opacity:n})]})]}),i==="farm"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,.1,0],rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[3,3]}),e.jsx("meshStandardMaterial",{color:"#8b5a2b",transparent:a,opacity:n})]}),[-1,-.3,.4,1.1].map((u,x)=>e.jsxs("mesh",{position:[u,.25,0],receiveShadow:!0,castShadow:!0,children:[e.jsx("boxGeometry",{args:[.4,.2,2.6]}),e.jsx("meshStandardMaterial",{color:"#a16207",roughness:.9,transparent:a,opacity:n})]},x)),Array.from({length:8}).map((u,x)=>{const j=-1.2+x%4*.8,C=-1+Math.floor(x/4)*1.2;return e.jsxs("mesh",{position:[j,.65,C],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.18,.7,6]}),e.jsx("meshStandardMaterial",{color:"#22c55e",emissive:"#16a34a",emissiveIntensity:o?0:.3,transparent:a,opacity:n})]},`crop-${x}`)}),e.jsxs("mesh",{position:[0,1,1.4],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.4,1.2,.8]}),e.jsx("meshStandardMaterial",{color:"#b45309",roughness:.8,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,1.8,1.4],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.6,.3,1]}),e.jsx("meshStandardMaterial",{color:"#92400e",roughness:.7,transparent:a,opacity:n})]}),[[-1.6,-1.6],[1.6,-1.6],[-1.6,1.6],[1.6,1.6]].map(([u,x],j)=>e.jsxs("mesh",{position:[u,.6,x],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.15,1.2,.15]}),e.jsx("meshStandardMaterial",{color:"#d97706",transparent:a,opacity:n})]},`fence-${j}`))]}),i==="mine"&&e.jsxs("mesh",{position:[.8,.5,.8],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"#2F2F2F",transparent:a,opacity:n})]}),i==="lumberMill"&&e.jsxs("mesh",{position:[0,2.2,0],rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.8,.8,2.2,8]}),e.jsx("meshStandardMaterial",{color:"#DEB887",transparent:a,opacity:n})]}),i==="bakery"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.9,.9,1.2,12]}),e.jsx("meshStandardMaterial",{color:"#fbbf24",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[.6,2.9,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.4,.6,6]}),e.jsx("meshStandardMaterial",{color:"#7c2d12",transparent:a,opacity:n})]})]}),i==="well"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,1.1,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.9,.9,1.2,16]}),e.jsx("meshStandardMaterial",{color:"#60a5fa",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,1.7,0],castShadow:!0,children:[e.jsx("torusGeometry",{args:[.8,.12,8,24]}),e.jsx("meshStandardMaterial",{color:"#1d4ed8",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.12,.12,.8,8]}),e.jsx("meshStandardMaterial",{color:"#9ca3af",transparent:a,opacity:n})]})]}),i==="campfire"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,.8,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.6,.7,.4,10]}),e.jsx("meshStandardMaterial",{color:"#92400e",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,1.1,0],children:[e.jsx("coneGeometry",{args:[.5,.6,10]}),e.jsx("meshStandardMaterial",{color:"#f97316",emissive:"#fb923c",emissiveIntensity:o?0:1.2,transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,.5,0],rotation:[Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[1,.1,8,24]}),e.jsx("meshStandardMaterial",{color:"#57534e",transparent:a,opacity:n})]})]}),i==="watchtower"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,2,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.7,.7,4,8]}),e.jsx("meshStandardMaterial",{color:"#9ca3af",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,4.2,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.2,.4,2.2]}),e.jsx("meshStandardMaterial",{color:"#4b5563",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,4.8,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1.6,1,6]}),e.jsx("meshStandardMaterial",{color:"#1f2937",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[1,1.2,1],rotation:[0,0,Math.PI/2],children:[e.jsx("boxGeometry",{args:[.2,2,.5]}),e.jsx("meshStandardMaterial",{color:"#d1d5db",transparent:a,opacity:n})]})]}),i==="fishery"&&e.jsxs("group",{children:[e.jsxs("mesh",{position:[0,1,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.5,1.6,2]}),e.jsx("meshStandardMaterial",{color:"#0ea5e9",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[2.7,.4,2.2]}),e.jsx("meshStandardMaterial",{color:"#075985",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[1.6,.5,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.5,.3,1]}),e.jsx("meshStandardMaterial",{color:"#7c3aed",transparent:a,opacity:n})]}),e.jsxs("mesh",{position:[0,.2,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[3,3]}),e.jsx("meshStandardMaterial",{color:"#38bdf8",transparent:!0,opacity:.3})]})]}),s&&!o&&e.jsxs("mesh",{position:[0,.1,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[1.5,1.7,32]}),e.jsx("meshBasicMaterial",{color:"#00ff00"})]}),!o&&e.jsx(z,{position:[0,3,0],center:!0,distanceFactor:15,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap",children:["Lvl ",l]})})]})},Ke=({id:i,position:l,scale:s=1})=>{const{addResource:o,removeNature:t,isBuilding:r,season:d}=H(),[n,a]=B.useState(!1),[u,x]=B.useState(0),[j,C]=B.useState(0),S=()=>{switch(d){case"spring":return n?"#2e8b2e":"#228B22";case"summer":return n?"#008000":"#006400";case"autumn":return n?"#CD853F":"#D2691E";case"winter":return n?"#F0FFFF":"#E0FFFF";default:return n?"#2e8b2e":"#228B22"}},w=b=>{b.stopPropagation(),o("wood",10),x(Date.now());const p=j+1;C(p),p>=5&&t(i)};return e.jsxs("group",{position:l,scale:[s*(n?1.1:1),s*(n?1.1:1),s*(n?1.1:1)],onPointerOver:()=>a(!0),onPointerOut:()=>a(!1),onClick:w,children:[e.jsxs("mesh",{position:[0,.75,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.2,.3,1.5,6]}),e.jsx("meshStandardMaterial",{color:n?"#6d4c3d":"#5C4033"})]}),e.jsxs("mesh",{position:[0,2,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1,2,8]}),e.jsx("meshStandardMaterial",{color:S()})]}),e.jsxs("mesh",{position:[0,3,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.8,1.5,8]}),e.jsx("meshStandardMaterial",{color:S()})]}),n&&!r&&e.jsx(z,{position:[0,4,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Wood (+10)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-j," more to clear)"]})]})}),Date.now()-u<1e3&&e.jsx(z,{position:[0,2,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-green-400 font-bold text-sm animate-bounce pointer-events-none",children:"+10 Wood"})})]})},Ye=({id:i,position:l,scale:s=1})=>{const{addResource:o,removeNature:t,isBuilding:r,season:d}=H(),[n,a]=B.useState(!1),[u,x]=B.useState(0),[j,C]=B.useState(0),S=()=>d==="winter"?n?"#cbd5e1":"#e2e8f0":d==="autumn"?n?"#b0a18f":"#8b7c6a":n?"#9ca3af":"#6b7280",w=b=>{b.stopPropagation(),o("stone",5),Math.random()>.7&&o("iron",2),x(Date.now());const p=j+1;C(p),p>=5&&t(i)};return e.jsxs("group",{position:l,scale:[s*(n?1.1:1),s*(n?1.1:1),s*(n?1.1:1)],rotation:[0,Math.random()*Math.PI,0],onPointerOver:()=>a(!0),onPointerOut:()=>a(!1),onClick:w,children:[e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[.8,0]}),e.jsx("meshStandardMaterial",{color:S(),flatShading:!0})]}),n&&!r&&e.jsx(z,{position:[0,1.5,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Stone (+5)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-j," more to clear)"]})]})}),Date.now()-u<1e3&&e.jsx(z,{position:[0,1,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-gray-300 font-bold text-sm animate-bounce pointer-events-none",children:"+5 Stone"})})]})},Qe=()=>{const i=H(l=>l.nature);return e.jsx("group",{children:i.map(l=>l.type==="tree"?e.jsx(Ke,{id:l.id,position:l.position,scale:l.scale},l.id):e.jsx(Ye,{id:l.id,position:l.position,scale:l.scale},l.id))})},Ve=({settler:i})=>{const l=B.useRef(null);return le(s=>{l.current&&(l.current.position.y=Math.sin(s.clock.elapsedTime*5)*.1,i.state==="walking"&&i.targetPosition&&l.current.lookAt(i.targetPosition[0],0,i.targetPosition[2]))}),e.jsxs("group",{position:i.position,ref:l,children:[e.jsxs("mesh",{position:[0,.5,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.2,.6,4,8]}),e.jsx("meshStandardMaterial",{color:"#3b82f6"})]}),e.jsxs("mesh",{position:[0,.9,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.2,16,16]}),e.jsx("meshStandardMaterial",{color:"#ffdbac"})]}),e.jsx(z,{position:[0,1.4,0],center:!0,distanceFactor:10,children:e.jsx("div",{className:"bg-black/50 text-white text-[10px] px-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none",children:i.name})}),e.jsxs("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("circleGeometry",{args:[.25,16]}),e.jsx("meshBasicMaterial",{color:"black",opacity:.3,transparent:!0})]})]})},es=()=>{const{buildings:i,nature:l,selectedBuilding:s,selectedBuildingId:o,isBuilding:t,addBuilding:r,selectBuildingId:d,setSelectedBuilding:n,season:a,settlers:u}=H(),[x,j]=B.useState(null),[C,S]=B.useState(!0),w=2,b=()=>{switch(a){case"spring":return"#5C8C46";case"summer":return"#4A7036";case"autumn":return"#8B7355";case"winter":return"#F0F8FF";default:return"#5C8C46"}},p=y=>{if(i.some(N=>N.position[0]===y[0]&&N.position[2]===y[2]))return!0;const c=y[0]-.8,g=y[0]+.8,M=y[2]-.8,R=y[2]+.8;return l.some(N=>N.position[0]>c&&N.position[0]<g&&N.position[2]>M&&N.position[2]<R)},k=y=>{if(!t||!s){x&&j(null);return}const $=Math.round(y.point.x/w)*w,c=Math.round(y.point.z/w)*w,g=[$,0,c];(!x||x[0]!==$||x[2]!==c)&&(j(g),S(!p(g)))},h=y=>{t&&s&&x?(y.stopPropagation(),C&&r(s,x)):(d(null),n(null))},P=(y,$)=>{t||(y.stopPropagation(),d($))};return e.jsxs("group",{children:[e.jsx(Qe,{}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,onPointerMove:k,onClick:h,children:[e.jsx("planeGeometry",{args:[100,100]}),e.jsx("meshStandardMaterial",{color:b()})]}),e.jsx("gridHelper",{args:[100,50,16777215,16777215],position:[0,.01,0],"material-opacity":.2,"material-transparent":!0}),i.map(y=>e.jsx("group",{position:y.position,children:e.jsx(ee,{type:y.type,level:y.level,selected:o===y.id,onClick:$=>P($,y.id)})},y.id)),u.map(y=>e.jsx(Ve,{settler:y},y.id)),t&&s&&x&&e.jsx("group",{position:x,children:e.jsx(ee,{type:s,ghost:!0,isValid:C})})]})},ss=()=>{const i=H(s=>s.tick),l=H(s=>s.tickRate);return B.useEffect(()=>{const s=setInterval(()=>{i()},l);return()=>clearInterval(s)},[i,l]),null},ts=()=>{const{day:i,weather:l}=H(),s=B.useRef(null),o=i%1,t=[Math.sin(o*Math.PI*2)*100,Math.cos(o*Math.PI*2+Math.PI)*100,20],r=t[1]/100;let d=Math.max(0,r);l!=="sunny"&&(d*=.5);const n=Math.max(.1,d*.5);let a=d>.2?"#87CEEB":"#050510";return l==="rain"&&(a="#708090"),l==="snow"&&(a="#E0FFFF"),l!=="sunny"&&d<.2&&(a="#050510"),e.jsxs(e.Fragment,{children:[e.jsx(ce,{sunPosition:t,turbidity:l!=="sunny"?10:.5,rayleigh:l!=="sunny"?.1:.5+(1-d)*.5,mieCoefficient:.005,mieDirectionalG:.7}),d<.2&&l==="sunny"&&e.jsx(de,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1}),d<.3&&l==="sunny"&&e.jsx(Z,{count:100,scale:50,size:4,speed:.4,opacity:.7,color:"#ffff00",position:[0,5,0]}),l==="rain"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{count:2e3,scale:[50,20,50],size:2,speed:2,opacity:.6,color:"#aaaaaa",position:[0,10,0]}),e.jsx(U,{position:[-10,15,-10],opacity:.5,speed:.2}),e.jsx(U,{position:[10,15,10],opacity:.5,speed:.2})]}),l==="snow"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{count:2e3,scale:[50,20,50],size:4,speed:.5,opacity:.8,color:"#ffffff",position:[0,10,0]}),e.jsx(U,{position:[-10,15,-10],opacity:.3,speed:.1,color:"#ffffff"}),e.jsx(U,{position:[10,15,10],opacity:.3,speed:.1,color:"#ffffff"})]}),e.jsx(he,{preset:l==="sunny"?"forest":"city",background:!1}),e.jsx("ambientLight",{intensity:n,color:l==="snow"?"#E0FFFF":d<.2?"#1a1a2e":"#ffffff"}),e.jsx("directionalLight",{ref:s,position:t,intensity:d*2,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4,children:e.jsx("orthographicCamera",{attach:"shadow-camera",args:[-50,50,50,-50]})}),e.jsx("fog",{attach:"fog",args:[a,10,80]})]})};function os(){return e.jsxs("div",{className:"relative w-full h-full bg-slate-900 touch-none",children:[e.jsx(ss,{}),e.jsx(ue,{shadows:!0,camera:{position:[20,20,20],fov:50},dpr:[1,2],gl:{antialias:!1},children:e.jsxs(B.Suspense,{fallback:e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"orange",wireframe:!0})]}),children:[e.jsx(ts,{}),e.jsx(es,{}),e.jsx(me,{makeDefault:!0,maxPolarAngle:Math.PI/2.2,minDistance:10,maxDistance:80,enableDamping:!0,dampingFactor:.05}),e.jsxs(De,{children:[e.jsx(Oe,{luminanceThreshold:1,mipmapBlur:!0,intensity:.5}),e.jsx(Ae,{}),e.jsx(He,{eskil:!1,offset:.1,darkness:.5})]})]})}),e.jsx(Xe,{})]})}console.log("Homestead Survival: Initializing...");console.log("Three.js Revision:",xe);class rs extends se.Component{constructor(l){super(l),this.state={hasError:!1,error:null}}static getDerivedStateFromError(l){return{hasError:!0,error:l}}componentDidCatch(l,s){console.error("Uncaught error:",l,s)}render(){var l;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-900 text-white p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-4",children:"Something went wrong"}),e.jsx("pre",{className:"bg-black/50 p-4 rounded text-sm overflow-auto max-w-full",children:(l=this.state.error)==null?void 0:l.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700",children:"Reload Game"})]}):this.props.children}}pe.createRoot(document.getElementById("root")).render(e.jsx(se.StrictMode,{children:e.jsx(rs,{children:e.jsx(os,{})})}));
