import{r as R,z as e,I as G,w as Z,J as q,K as X,Q as z,X as O,Y as K,Z as Q,_ as Y,p as V,R as J,$ as ee}from"./vendor-CvYXfu-e.js";import{c as te,P as se,U as oe,S as ne,a as re,C as ae,b as ie,d as le,R as ce,X as de,A as ue,T as he,M as me,H as xe,W as pe,e as ge,E as fe,B as be,f as we,V as je}from"./game-iU6JZohG.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const ye={};function ve(i,l){let t;try{t=i()}catch{return}return{getItem:s=>{var n;const c=u=>u===null?null:JSON.parse(u,void 0),r=(n=t.getItem(s))!=null?n:null;return r instanceof Promise?r.then(c):c(r)},setItem:(s,n)=>t.setItem(s,JSON.stringify(n,void 0)),removeItem:s=>t.removeItem(s)}}const A=i=>l=>{try{const t=i(l);return t instanceof Promise?t:{then(o){return A(o)(t)},catch(o){return this}}}catch(t){return{then(o){return this},catch(o){return A(o)(t)}}}},ke=(i,l)=>(t,o,s)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:d=>d,version:0,merge:(d,k)=>({...k,...d}),...l},c=!1;const r=new Set,u=new Set;let h;try{h=n.getStorage()}catch{}if(!h)return i((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...d)},o,s);const j=A(n.serialize),w=()=>{const d=n.partialize({...o()});let k;const m=j({state:d,version:n.version}).then(N=>h.setItem(n.name,N)).catch(N=>{k=N});if(k)throw k;return m},S=s.setState;s.setState=(d,k)=>{S(d,k),w()};const y=i((...d)=>{t(...d),w()},o,s);let g;const p=()=>{var d;if(!h)return;c=!1,r.forEach(m=>m(o()));const k=((d=n.onRehydrateStorage)==null?void 0:d.call(n,o()))||void 0;return A(h.getItem.bind(h))(n.name).then(m=>{if(m)return n.deserialize(m)}).then(m=>{if(m)if(typeof m.version=="number"&&m.version!==n.version){if(n.migrate)return n.migrate(m.state,m.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return m.state}).then(m=>{var N;return g=n.merge(m,(N=o())!=null?N:y),t(g,!0),w()}).then(()=>{k==null||k(g,void 0),c=!0,u.forEach(m=>m(g))}).catch(m=>{k==null||k(void 0,m)})};return s.persist={setOptions:d=>{n={...n,...d},d.getStorage&&(h=d.getStorage())},clearStorage:()=>{h==null||h.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>p(),hasHydrated:()=>c,onHydrate:d=>(r.add(d),()=>{r.delete(d)}),onFinishHydration:d=>(u.add(d),()=>{u.delete(d)})},p(),g||y},Se=(i,l)=>(t,o,s)=>{let n={storage:ve(()=>localStorage),partialize:p=>p,version:0,merge:(p,d)=>({...d,...p}),...l},c=!1;const r=new Set,u=new Set;let h=n.storage;if(!h)return i((...p)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...p)},o,s);const j=()=>{const p=n.partialize({...o()});return h.setItem(n.name,{state:p,version:n.version})},w=s.setState;s.setState=(p,d)=>{w(p,d),j()};const S=i((...p)=>{t(...p),j()},o,s);s.getInitialState=()=>S;let y;const g=()=>{var p,d;if(!h)return;c=!1,r.forEach(m=>{var N;return m((N=o())!=null?N:S)});const k=((d=n.onRehydrateStorage)==null?void 0:d.call(n,(p=o())!=null?p:S))||void 0;return A(h.getItem.bind(h))(n.name).then(m=>{if(m)if(typeof m.version=="number"&&m.version!==n.version){if(n.migrate)return[!0,n.migrate(m.state,m.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,m.state];return[!1,void 0]}).then(m=>{var N;const[a,x]=m;if(y=n.merge(x,(N=o())!=null?N:S),t(y,!0),a)return j()}).then(()=>{k==null||k(y,void 0),y=o(),c=!0,u.forEach(m=>m(y))}).catch(m=>{k==null||k(void 0,m)})};return s.persist={setOptions:p=>{n={...n,...p},p.storage&&(h=p.storage)},clearStorage:()=>{h==null||h.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>g(),hasHydrated:()=>c,onHydrate:p=>(r.add(p),()=>{r.delete(p)}),onFinishHydration:p=>(u.add(p),()=>{u.delete(p)})},n.skipHydration||g(),y||S},Me=(i,l)=>"getStorage"in l||"serialize"in l||"deserialize"in l?((ye?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),ke(i,l)):Se(i,l),Ne=Me,$={cabin:{wood:10},farm:{wood:20,stone:5},lumberMill:{wood:50,stone:10},mine:{wood:100,stone:50},warehouse:{wood:100,stone:20},bakery:{wood:60,stone:20},well:{wood:30,stone:40}},E={cabin:{housing:4},farm:{workers:1},lumberMill:{workers:2},mine:{workers:3},warehouse:{storage:200},bakery:{workers:2,happiness:.4},well:{happiness:.6}},Ce={cabin:{},farm:{food:5},lumberMill:{wood:5},mine:{stone:2,iron:1},warehouse:{},bakery:{food:8},well:{}},F=()=>Math.random().toString(36).substr(2,9),L=te()(Ne((i,l)=>({resources:{wood:100,food:50,stone:0,iron:0},settlers:[{id:"settler-1",name:"John",position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0},{id:"settler-2",name:"Jane",position:[2,0,2],targetPosition:null,state:"idle",actionTimer:0}],happiness:100,buildings:[],nature:(()=>{const t=[];for(let o=0;o<40;o++){const s=Math.random()*Math.PI*2,n=15+Math.random()*30,c=Math.cos(s)*n,r=Math.sin(s)*n,u=Math.random()>.3?"tree":"rock",h=.8+Math.random()*.5;t.push({id:`nature-${o}`,position:[c,0,r],type:u,scale:h})}return t})(),logs:[],weather:"sunny",season:"spring",selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,tickRate:1e3,day:1,addLog:(t,o="info")=>{i(s=>({logs:[{id:F(),message:t,timestamp:Date.now(),type:o},...s.logs].slice(0,20)}))},addResource:(t,o)=>i(s=>{const r=100+s.buildings.reduce((j,w)=>j+(E[w.type].storage||0)*w.level,0),u=s.resources[t],h=Math.min(u+o,r);return{resources:{...s.resources,[t]:h}}}),removeResource:(t,o)=>l().resources[t]>=o?(i(n=>({resources:{...n.resources,[t]:n.resources[t]-o}})),!0):!1,removeNature:t=>{const o=l(),s=o.nature.find(n=>n.id===t);s&&(o.addLog(`Cleared ${s.type}`,"info"),i(n=>({nature:n.nature.filter(c=>c.id!==t)})))},addBuilding:(t,o)=>{const s=l(),n=s.buildings.some(g=>g.position[0]===o[0]&&g.position[2]===o[2]),c=o[0]-.8,r=o[0]+.8,u=o[2]-.8,h=o[2]+.8,j=s.nature.some(g=>g.position[0]>c&&g.position[0]<r&&g.position[2]>u&&g.position[2]<h);if(n||j){s.addLog("Cannot build here!","warning");return}const w=$[t],S=E[t];let y=!0;if(Object.keys(w).forEach(g=>{(s.resources[g]||0)<(w[g]||0)&&(y=!1)}),!y){s.addLog("Not enough resources!","warning");return}if(S.workers){const g=s.buildings.reduce((p,d)=>p+(E[d.type].workers||0),0);if(s.settlers.length-g<S.workers){y=!1,s.addLog("Not enough workers!","warning");return}}y&&(Object.keys(w).forEach(g=>{s.removeResource(g,w[g]||0)}),i(g=>({buildings:[...g.buildings,{id:F(),type:t,position:o,level:1,lastCollected:Date.now()}],isBuilding:!1,selectedBuilding:null})),s.addLog(`Built ${t}!`,"success"))},upgradeBuilding:t=>{const o=l(),s=o.buildings.find(u=>u.id===t);if(!s)return;const n=$[s.type],c=s.level+1;let r=!0;Object.keys(n).forEach(u=>{const h=(n[u]||0)*c;(o.resources[u]||0)<h&&(r=!1)}),r?(Object.keys(n).forEach(u=>{const h=(n[u]||0)*c;o.removeResource(u,h)}),i(u=>({buildings:u.buildings.map(h=>h.id===t?{...h,level:h.level+1}:h)})),o.addLog(`Upgraded ${s.type} to level ${s.level+1}`,"success")):o.addLog("Not enough resources to upgrade!","warning")},demolishBuilding:t=>{const o=l(),s=o.buildings.find(n=>n.id===t);if(s){o.addLog(`Demolished ${s.type}`,"danger");const n=o.settlers.map(c=>c.job===t?{...c,job:void 0,state:"idle"}:c.home===t?{...c,home:void 0}:c);i(c=>({buildings:c.buildings.filter(r=>r.id!==t),settlers:n,selectedBuildingId:null}))}},assignWorker:t=>{const o=l(),s=o.buildings.find(u=>u.id===t);if(!s)return;const n=E[s.type];if(!n.workers){o.addLog(`${s.type} does not require workers.`,"warning");return}if(o.settlers.filter(u=>u.job===t).length>=(n.workers||0)){o.addLog(`${s.type} is fully staffed.`,"warning");return}const r=o.settlers.find(u=>!u.job);r?(i(u=>({settlers:u.settlers.map(h=>h.id===r.id?{...h,job:t}:h)})),o.addLog(`${r.name} assigned to ${s.type}.`,"success")):o.addLog("No unemployed settlers available.","warning")},unassignWorker:t=>{const o=l(),s=o.settlers.find(n=>n.job===t);s&&(i(n=>({settlers:n.settlers.map(c=>c.id===s.id?{...c,job:void 0,state:"idle"}:c)})),o.addLog(`${s.name} unassigned from job.`,"info"))},setSelectedBuilding:t=>i({selectedBuilding:t,isBuilding:!!t,selectedBuildingId:null}),selectBuildingId:t=>i({selectedBuildingId:t,selectedBuilding:null,isBuilding:!1}),setTickRate:t=>{const o=Math.min(2e3,Math.max(300,t));i({tickRate:o})},tick:()=>{i(t=>{const o={...t.resources};let s=[...t.settlers],n=t.weather,c=t.season,r=[...t.logs];const u=t.buildings.filter(a=>a.type==="well").length,h=t.buildings.filter(a=>a.type==="bakery").length,w=Math.floor(t.day/10)%4,S=["spring","summer","autumn","winter"];if(S[w]!==t.season&&(c=S[w],r=[{id:F(),message:`Season changed to ${c}!`,timestamp:Date.now(),type:"info"},...r].slice(0,20)),Math.random()<.01){const a=Math.random();a<.6?n="sunny":a<.85?n="rain":n="snow",n!==t.weather&&(r=[{id:F(),message:`Weather changed to ${n}!`,timestamp:Date.now(),type:"info"},...r].slice(0,20))}const y=100,g=t.buildings.reduce((a,x)=>a+(E[x.type].storage||0)*x.level,0),p=y+g;let d=t.happiness;const k=t.buildings.reduce((a,x)=>a+(E[x.type].happiness||0)*x.level,0);d=Math.min(100,d+k);const m=.5+s.length*.5;if(o.food>=m){if(o.food-=m,d<100&&(d+=.5),o.food>m*2&&d>80&&s.length<t.buildings.reduce((x,b)=>x+(E[b.type].housing||0),2)&&Math.random()<.05){const x=["James","Mary","Robert","Patricia","John","Jennifer","Michael","Linda","David","Elizabeth"],b=x[Math.floor(Math.random()*x.length)];s.push({id:F(),name:b,position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0}),r=[{id:F(),message:`${b} arrived!`,timestamp:Date.now(),type:"success"},...r].slice(0,20)}const a=d/100;t.buildings.forEach(x=>{const b=E[x.type];let C=1;b.workers&&(C=s.filter(M=>M.job===x.id).length/b.workers);const v=C*a,I=Ce[x.type];I&&v>0&&Object.keys(I).forEach(P=>{let M=(I[P]||0)*v*x.level;c==="winter"&&P==="food"&&(M*=.2),c==="autumn"&&P==="food"&&(M*=1.5),o[P]=Math.min(o[P]+M,p)})}),h>0&&(d=Math.min(100,d+.4*h))}else if(o.food=0,d=Math.max(0,d-10),Math.random()<.1&&s.length>1){const a=Math.floor(Math.random()*s.length),x=s[a];s.splice(a,1),r=[{id:F(),message:`${x.name} died from starvation!`,timestamp:Date.now(),type:"danger"},...r].slice(0,20)}const N=2+t.buildings.reduce((a,x)=>a+(E[x.type].housing||0),0);if(s.length>N&&(d=Math.max(0,d-2)),n==="rain"||n==="snow"){const a=Math.max(0,.1-u*.05);d=Math.max(0,d-a)}if(d=Math.min(100,Math.max(0,d)),Math.random()<.008){const a=Math.random();if(a<.33){const x=20+Math.round(Math.random()*20),b=10+Math.round(Math.random()*15);o.wood=Math.min(p,o.wood+x),o.food=Math.min(p,o.food+b),r=[{id:F(),message:`A wandering trader gifted ${x} wood and ${b} food!`,timestamp:Date.now(),type:"success"},...r].slice(0,20)}else if(a<.66){const x=Math.max(5,Math.round(o.wood*.1)),b=Math.max(0,x-u*3);o.wood=Math.max(0,o.wood-b),d=Math.max(0,d-2),r=[{id:F(),message:`A storm felled trees. Lost ${b} wood, but wells reduced the damage.`,timestamp:Date.now(),type:"warning"},...r].slice(0,20)}else d=Math.min(100,d+5+u),r=[{id:F(),message:"A village festival lifted everyone's spirits! (+Happiness)",timestamp:Date.now(),type:"success"},...r].slice(0,20)}return s=s.map(a=>{const x=t.day%1,b=x>.75||x<.2,C=x>.25&&x<.7;if(a.job&&C){const v=t.buildings.find(I=>I.id===a.job);if(v)return Math.sqrt(Math.pow(a.position[0]-v.position[0],2)+Math.pow(a.position[2]-v.position[2],2))>2?{...a,state:"walking",targetPosition:v.position}:{...a,state:"working",targetPosition:null}}if(b){const v=[0,0,0];return Math.sqrt(Math.pow(a.position[0]-v[0],2)+Math.pow(a.position[2]-v[2],2))>2?{...a,state:"walking",targetPosition:v}:{...a,state:"resting",targetPosition:null}}if(a.state==="idle"||a.state==="working"&&!C||a.state==="resting"&&!b){if(Math.random()<.02){const v=Math.random()*Math.PI*2,I=3+Math.random()*8,P=Math.cos(v)*I,M=Math.sin(v)*I;return{...a,state:"walking",targetPosition:[P,0,M]}}return{...a,state:"idle"}}if(a.state==="walking"&&a.targetPosition){const v=a.targetPosition[0]-a.position[0],I=a.targetPosition[2]-a.position[2],P=Math.sqrt(v*v+I*I),M=.08;return P<M?{...a,position:a.targetPosition,targetPosition:null,state:"idle"}:{...a,position:[a.position[0]+v/P*M,0,a.position[2]+I/P*M]}}return a}),{resources:o,settlers:s,happiness:d,weather:n,season:c,day:t.day+.005,logs:r,tickRate:t.tickRate}})},reset:()=>{const t=[];for(let o=0;o<40;o++){const s=Math.random()*Math.PI*2,n=15+Math.random()*30,c=Math.cos(s)*n,r=Math.sin(s)*n,u=Math.random()>.3?"tree":"rock",h=.8+Math.random()*.5;t.push({id:`nature-${o}`,position:[c,0,r],type:u,scale:h})}i({resources:{wood:100,food:50,stone:0,iron:0},settlers:[{id:"settler-1",name:"John",position:[0,0,0],targetPosition:null,state:"idle",actionTimer:0},{id:"settler-2",name:"Jane",position:[2,0,2],targetPosition:null,state:"idle",actionTimer:0}],happiness:100,buildings:[],nature:t,logs:[],weather:"sunny",season:"spring",selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,day:1,tickRate:1e3})}}),{name:"homestead-storage",partialize:i=>({resources:i.resources,settlers:i.settlers,happiness:i.happiness,buildings:i.buildings,nature:i.nature,logs:i.logs,weather:i.weather,season:i.season,day:i.day,tickRate:i.tickRate})})),Ie=({type:i})=>{switch(i){case"wood":return e.jsx(ge,{className:"w-4 h-4 text-amber-700"});case"food":return e.jsx(pe,{className:"w-4 h-4 text-yellow-600"});case"stone":return e.jsx(xe,{className:"w-4 h-4 text-stone-500"});case"iron":return e.jsx(me,{className:"w-4 h-4 text-slate-400"})}},Pe=()=>{const{resources:i,settlers:l,happiness:t,weather:o,isBuilding:s,selectedBuilding:n,setSelectedBuilding:c,day:r,reset:u,season:h,buildings:j,selectedBuildingId:w,selectBuildingId:S,upgradeBuilding:y,demolishBuilding:g,logs:p,tickRate:d,setTickRate:k}=L(),[m,N]=R.useState(!1),a=f=>{c(n===f&&s?null:f)},x=()=>{confirm("Are you sure you want to reset your progress? This cannot be undone.")&&(u(),N(!1))},b=w?j.find(f=>f.id===w):null,C=b?$[b.type]:null,v=b?b.level+1:1,I=C&&Object.keys(C).every(f=>{const B=f;return i[B]>=(C[B]||0)*v}),P=100,M=j.reduce((f,B)=>f+(E[B.type].storage||0)*B.level,0),H=P+M;return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-4",children:[e.jsxs("div",{className:"flex justify-between items-start pointer-events-auto",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex gap-4 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:[Object.entries(i).map(([f,B])=>e.jsxs("div",{className:"flex items-center gap-2 min-w-[80px]",children:[e.jsx(Ie,{type:f}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:f}),e.jsx("span",{className:`font-mono font-bold ${B>=H?"text-red-400":""}`,children:Math.floor(B)})]})]},f)),e.jsxs("div",{className:"border-l border-white/10 pl-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Cap"}),e.jsx("span",{className:"font-mono font-bold text-gray-300",children:H})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl min-w-[80px]",children:[e.jsx(oe,{className:"w-4 h-4 text-blue-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Pop"}),e.jsx("span",{className:"font-mono font-bold",children:l.length})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl min-w-[80px]",children:[e.jsx(ne,{className:`w-4 h-4 ${t>80?"text-green-400":t>40?"text-yellow-400":"text-red-400"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Happy"}),e.jsxs("span",{className:"font-mono font-bold",children:[Math.floor(t),"%"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:e.jsxs("div",{className:"text-sm font-bold",children:["Day ",r.toFixed(1)]})}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl flex items-center gap-2",children:[o==="sunny"&&e.jsx(re,{className:"w-4 h-4 text-yellow-300"}),o==="rain"&&e.jsx(ae,{className:"w-4 h-4 text-blue-300"}),o==="snow"&&e.jsx(ie,{className:"w-4 h-4 text-cyan-200"}),e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Weather"}),e.jsx("span",{className:"font-mono font-bold capitalize",children:o})]})]}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl flex flex-col leading-tight",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Season"}),e.jsx("span",{className:"font-mono font-bold capitalize",children:h})]}),e.jsx("button",{onClick:()=>N(!m),className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl hover:bg-white/10 transition-colors",children:e.jsx(le,{className:"w-5 h-5"})})]})]}),m&&e.jsxs("div",{className:"absolute top-20 right-4 bg-black/80 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl pointer-events-auto z-50 flex flex-col gap-2 min-w-[200px]",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Settings"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Game Speed"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1200,800,500].map(f=>e.jsxs("button",{onClick:()=>k(f),className:`px-3 py-2 rounded-lg text-sm font-semibold border transition-colors ${d===f?"bg-green-600/30 border-green-400 text-green-100":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[Math.round(1e3/f),"x"]},f))}),e.jsx("div",{className:"text-[11px] text-gray-400",children:"Higher speeds update the world more frequently."})]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/40 text-red-200 px-4 py-2 rounded-lg transition-colors w-full text-left",children:[e.jsx(ce,{className:"w-4 h-4"}),"Reset Progress"]}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"v0.2.0 Beta"})]}),e.jsx("div",{className:"absolute bottom-32 left-4 flex flex-col gap-2 w-[300px] pointer-events-none opacity-80",children:p.slice(0,5).map(f=>e.jsx("div",{className:`
                    p-2 rounded-lg text-sm font-medium backdrop-blur-md shadow-lg border border-white/5 animate-in slide-in-from-left-4 fade-in duration-300
                    ${f.type==="success"?"bg-green-900/60 text-green-100":f.type==="warning"?"bg-yellow-900/60 text-yellow-100":f.type==="danger"?"bg-red-900/60 text-red-100":"bg-gray-900/60 text-gray-100"}
                `,children:f.message},f.id))}),b&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-md p-6 rounded-2xl border border-white/10 text-white shadow-2xl pointer-events-auto z-40 min-w-[300px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl capitalize",children:b.type}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Level ",b.level]})]}),e.jsx("button",{onClick:()=>S(null),className:"text-gray-400 hover:text-white",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>y(b.id),disabled:!I,className:`
                          flex items-center justify-between p-3 rounded-xl border border-white/10 transition-all
                          ${I?"bg-green-600/20 hover:bg-green-600/40 border-green-500/50":"bg-gray-800/50 opacity-50 cursor-not-allowed"}
                      `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold",children:"Upgrade"}),e.jsx("div",{className:"text-xs text-gray-300",children:"Increases efficiency"})]})]}),e.jsx("div",{className:"flex flex-col items-end text-xs",children:C&&Object.entries(C).map(([f,B])=>e.jsxs("div",{className:i[f]<B*v?"text-red-400":"text-gray-300",children:[B*v," ",f.charAt(0).toUpperCase()]},f))})]}),e.jsxs("button",{onClick:()=>g(b.id),className:"flex items-center gap-2 p-3 rounded-xl bg-red-500/10 hover:bg-red-500/30 border border-red-500/30 text-red-200 transition-colors",children:[e.jsx(he,{className:"w-5 h-5"}),"Demolish Building"]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4 pointer-events-auto mb-4 w-full px-4",children:[s&&e.jsxs("div",{className:"bg-black/80 text-white px-6 py-3 rounded-full text-base animate-pulse border border-yellow-500/50 shadow-lg",children:["Placing ",n,"... (Tap to build)"]}),e.jsx("div",{className:"flex gap-3 bg-black/80 backdrop-blur-md p-3 rounded-2xl border border-white/10 shadow-2xl overflow-x-auto w-full max-w-full scrollbar-hide",children:Object.keys($).map(f=>{const B=$[f],W=n===f,T=Object.keys(B).every(D=>i[D]>=(B[D]||0));return e.jsxs("button",{onClick:()=>a(f),disabled:!T,className:`
                  relative group flex flex-col items-center gap-2 p-4 rounded-xl transition-all duration-200 min-w-[110px] flex-shrink-0
                  ${W?"bg-yellow-600 text-white ring-2 ring-yellow-400":"bg-white/5 hover:bg-white/10 text-gray-300"}
                  ${T?"active:scale-95":"opacity-50 cursor-not-allowed grayscale"}
                `,children:[e.jsx("span",{className:"capitalize font-bold text-sm md:text-base",children:f.replace(/([A-Z])/g," $1").trim()}),e.jsx("div",{className:"flex gap-2 text-xs",children:Object.entries(B).map(([D,_])=>e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:i[D]<_?"text-red-400":"text-gray-400",children:[_," ",D.charAt(0).toUpperCase()]})},D))})]},f)})})]})]})},U=({type:i,level:l=1,selected:t,ghost:o,isValid:s=!0,onClick:n})=>{const c=R.useMemo(()=>{if(o&&!s)return"#ff0000";switch(i){case"cabin":return"#8B4513";case"farm":return"#DAA520";case"lumberMill":return"#556B2F";case"mine":return"#696969";case"warehouse":return"#A0522D";case"bakery":return"#d97706";case"well":return"#3b82f6";default:return"#ffffff"}},[i,o,s]),r=o?.5:1,u=o;return e.jsxs("group",{onClick:n,children:[e.jsxs("mesh",{position:[0,1,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[2,2,2]}),e.jsx("meshStandardMaterial",{color:c,transparent:u,opacity:r})]}),(i==="cabin"||i==="farm")&&e.jsxs("mesh",{position:[0,2.5,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1.6,1.5,4]}),e.jsx("meshStandardMaterial",{color:"#4A3B2C",transparent:u,opacity:r})]}),i==="mine"&&e.jsxs("mesh",{position:[.8,.5,.8],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"#2F2F2F",transparent:u,opacity:r})]}),i==="lumberMill"&&e.jsxs("mesh",{position:[0,2.2,0],rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.8,.8,2.2,8]}),e.jsx("meshStandardMaterial",{color:"#DEB887",transparent:u,opacity:r})]}),i==="bakery"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.9,.9,1.2,12]}),e.jsx("meshStandardMaterial",{color:"#fbbf24",transparent:u,opacity:r})]}),e.jsxs("mesh",{position:[.6,2.9,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.4,.6,6]}),e.jsx("meshStandardMaterial",{color:"#7c2d12",transparent:u,opacity:r})]})]}),i==="well"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,1.1,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.9,.9,1.2,16]}),e.jsx("meshStandardMaterial",{color:"#60a5fa",transparent:u,opacity:r})]}),e.jsxs("mesh",{position:[0,1.7,0],castShadow:!0,children:[e.jsx("torusGeometry",{args:[.8,.12,8,24]}),e.jsx("meshStandardMaterial",{color:"#1d4ed8",transparent:u,opacity:r})]}),e.jsxs("mesh",{position:[0,2.3,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.12,.12,.8,8]}),e.jsx("meshStandardMaterial",{color:"#9ca3af",transparent:u,opacity:r})]})]}),t&&!o&&e.jsxs("mesh",{position:[0,.1,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[1.5,1.7,32]}),e.jsx("meshBasicMaterial",{color:"#00ff00"})]}),!o&&e.jsx(G,{position:[0,3,0],center:!0,distanceFactor:15,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap",children:["Lvl ",l]})})]})},Be=({id:i,position:l,scale:t=1})=>{const{addResource:o,removeNature:s,isBuilding:n,season:c}=L(),[r,u]=R.useState(!1),[h,j]=R.useState(0),[w,S]=R.useState(0),y=()=>{switch(c){case"spring":return r?"#2e8b2e":"#228B22";case"summer":return r?"#008000":"#006400";case"autumn":return r?"#CD853F":"#D2691E";case"winter":return r?"#F0FFFF":"#E0FFFF";default:return r?"#2e8b2e":"#228B22"}},g=p=>{p.stopPropagation(),o("wood",10),j(Date.now());const d=w+1;S(d),d>=5&&s(i)};return e.jsxs("group",{position:l,scale:[t*(r?1.1:1),t*(r?1.1:1),t*(r?1.1:1)],onPointerOver:()=>u(!0),onPointerOut:()=>u(!1),onClick:g,children:[e.jsxs("mesh",{position:[0,.75,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.2,.3,1.5,6]}),e.jsx("meshStandardMaterial",{color:r?"#6d4c3d":"#5C4033"})]}),e.jsxs("mesh",{position:[0,2,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1,2,8]}),e.jsx("meshStandardMaterial",{color:y()})]}),e.jsxs("mesh",{position:[0,3,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.8,1.5,8]}),e.jsx("meshStandardMaterial",{color:y()})]}),r&&!n&&e.jsx(G,{position:[0,4,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Wood (+10)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-w," more to clear)"]})]})}),Date.now()-h<1e3&&e.jsx(G,{position:[0,2,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-green-400 font-bold text-sm animate-bounce pointer-events-none",children:"+10 Wood"})})]})},Re=({id:i,position:l,scale:t=1})=>{const{addResource:o,removeNature:s,isBuilding:n,season:c}=L(),[r,u]=R.useState(!1),[h,j]=R.useState(0),[w,S]=R.useState(0),y=()=>c==="winter"?r?"#cbd5e1":"#e2e8f0":c==="autumn"?r?"#b0a18f":"#8b7c6a":r?"#9ca3af":"#6b7280",g=p=>{p.stopPropagation(),o("stone",5),Math.random()>.7&&o("iron",2),j(Date.now());const d=w+1;S(d),d>=5&&s(i)};return e.jsxs("group",{position:l,scale:[t*(r?1.1:1),t*(r?1.1:1),t*(r?1.1:1)],rotation:[0,Math.random()*Math.PI,0],onPointerOver:()=>u(!0),onPointerOut:()=>u(!1),onClick:g,children:[e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[.8,0]}),e.jsx("meshStandardMaterial",{color:y(),flatShading:!0})]}),r&&!n&&e.jsx(G,{position:[0,1.5,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Stone (+5)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-w," more to clear)"]})]})}),Date.now()-h<1e3&&e.jsx(G,{position:[0,1,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-gray-300 font-bold text-sm animate-bounce pointer-events-none",children:"+5 Stone"})})]})},Fe=()=>{const i=L(l=>l.nature);return e.jsx("group",{children:i.map(l=>l.type==="tree"?e.jsx(Be,{id:l.id,position:l.position,scale:l.scale},l.id):e.jsx(Re,{id:l.id,position:l.position,scale:l.scale},l.id))})},Ee=({settler:i})=>{const l=R.useRef(null);return Z(t=>{l.current&&(l.current.position.y=Math.sin(t.clock.elapsedTime*5)*.1,i.state==="walking"&&i.targetPosition&&l.current.lookAt(i.targetPosition[0],0,i.targetPosition[2]))}),e.jsxs("group",{position:i.position,ref:l,children:[e.jsxs("mesh",{position:[0,.5,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.2,.6,4,8]}),e.jsx("meshStandardMaterial",{color:"#3b82f6"})]}),e.jsxs("mesh",{position:[0,.9,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.2,16,16]}),e.jsx("meshStandardMaterial",{color:"#ffdbac"})]}),e.jsx(G,{position:[0,1.4,0],center:!0,distanceFactor:10,children:e.jsx("div",{className:"bg-black/50 text-white text-[10px] px-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none",children:i.name})}),e.jsxs("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("circleGeometry",{args:[.25,16]}),e.jsx("meshBasicMaterial",{color:"black",opacity:.3,transparent:!0})]})]})},Le=()=>{const{buildings:i,nature:l,selectedBuilding:t,selectedBuildingId:o,isBuilding:s,addBuilding:n,selectBuildingId:c,setSelectedBuilding:r,season:u,settlers:h}=L(),[j,w]=R.useState(null),[S,y]=R.useState(!0),g=2,p=()=>{switch(u){case"spring":return"#5C8C46";case"summer":return"#4A7036";case"autumn":return"#8B7355";case"winter":return"#F0F8FF";default:return"#5C8C46"}},d=a=>{if(i.some(M=>M.position[0]===a[0]&&M.position[2]===a[2]))return!0;const b=a[0]-.8,C=a[0]+.8,v=a[2]-.8,I=a[2]+.8;return l.some(M=>M.position[0]>b&&M.position[0]<C&&M.position[2]>v&&M.position[2]<I)},k=a=>{if(!s||!t){j&&w(null);return}const x=Math.round(a.point.x/g)*g,b=Math.round(a.point.z/g)*g,C=[x,0,b];(!j||j[0]!==x||j[2]!==b)&&(w(C),y(!d(C)))},m=a=>{s&&t&&j?(a.stopPropagation(),S&&n(t,j)):(c(null),r(null))},N=(a,x)=>{s||(a.stopPropagation(),c(x))};return e.jsxs("group",{children:[e.jsx(Fe,{}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,onPointerMove:k,onClick:m,children:[e.jsx("planeGeometry",{args:[100,100]}),e.jsx("meshStandardMaterial",{color:p()})]}),e.jsx("gridHelper",{args:[100,50,16777215,16777215],position:[0,.01,0],"material-opacity":.2,"material-transparent":!0}),i.map(a=>e.jsx("group",{position:a.position,children:e.jsx(U,{type:a.type,level:a.level,selected:o===a.id,onClick:x=>N(x,a.id)})},a.id)),h.map(a=>e.jsx(Ee,{settler:a},a.id)),s&&t&&j&&e.jsx("group",{position:j,children:e.jsx(U,{type:t,ghost:!0,isValid:S})})]})},De=()=>{const i=L(t=>t.tick),l=L(t=>t.tickRate);return R.useEffect(()=>{const t=setInterval(()=>{i()},l);return()=>clearInterval(t)},[i,l]),null},Ge=()=>{const{day:i,weather:l}=L(),t=R.useRef(null),o=i%1,s=[Math.sin(o*Math.PI*2)*100,Math.cos(o*Math.PI*2+Math.PI)*100,20],n=s[1]/100;let c=Math.max(0,n);l!=="sunny"&&(c*=.5);const r=Math.max(.1,c*.5);let u=c>.2?"#87CEEB":"#050510";return l==="rain"&&(u="#708090"),l==="snow"&&(u="#E0FFFF"),l!=="sunny"&&c<.2&&(u="#050510"),e.jsxs(e.Fragment,{children:[e.jsx(q,{sunPosition:s,turbidity:l!=="sunny"?10:.5,rayleigh:l!=="sunny"?.1:.5+(1-c)*.5,mieCoefficient:.005,mieDirectionalG:.7}),c<.2&&l==="sunny"&&e.jsx(X,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1}),c<.3&&l==="sunny"&&e.jsx(z,{count:100,scale:50,size:4,speed:.4,opacity:.7,color:"#ffff00",position:[0,5,0]}),l==="rain"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{count:2e3,scale:[50,20,50],size:2,speed:2,opacity:.6,color:"#aaaaaa",position:[0,10,0]}),e.jsx(O,{position:[-10,15,-10],opacity:.5,speed:.2}),e.jsx(O,{position:[10,15,10],opacity:.5,speed:.2})]}),l==="snow"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{count:2e3,scale:[50,20,50],size:4,speed:.5,opacity:.8,color:"#ffffff",position:[0,10,0]}),e.jsx(O,{position:[-10,15,-10],opacity:.3,speed:.1,color:"#ffffff"}),e.jsx(O,{position:[10,15,10],opacity:.3,speed:.1,color:"#ffffff"})]}),e.jsx(K,{preset:l==="sunny"?"forest":"city",background:!1}),e.jsx("ambientLight",{intensity:r,color:l==="snow"?"#E0FFFF":c<.2?"#1a1a2e":"#ffffff"}),e.jsx("directionalLight",{ref:t,position:s,intensity:c*2,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4,children:e.jsx("orthographicCamera",{attach:"shadow-camera",args:[-50,50,50,-50]})}),e.jsx("fog",{attach:"fog",args:[u,10,80]})]})};function $e(){return e.jsxs("div",{className:"relative w-full h-full bg-slate-900 touch-none",children:[e.jsx(De,{}),e.jsx(Q,{shadows:!0,camera:{position:[20,20,20],fov:50},dpr:[1,2],gl:{antialias:!1},children:e.jsxs(R.Suspense,{fallback:e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"orange",wireframe:!0})]}),children:[e.jsx(Ge,{}),e.jsx(Le,{}),e.jsx(Y,{makeDefault:!0,maxPolarAngle:Math.PI/2.2,minDistance:10,maxDistance:80,enableDamping:!0,dampingFactor:.05}),e.jsxs(fe,{children:[e.jsx(be,{luminanceThreshold:1,mipmapBlur:!0,intensity:.5}),e.jsx(we,{}),e.jsx(je,{eskil:!1,offset:.1,darkness:.5})]})]})}),e.jsx(Pe,{})]})}console.log("Homestead Survival: Initializing...");console.log("Three.js Revision:",V);class Ae extends J.Component{constructor(l){super(l),this.state={hasError:!1,error:null}}static getDerivedStateFromError(l){return{hasError:!0,error:l}}componentDidCatch(l,t){console.error("Uncaught error:",l,t)}render(){var l;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-900 text-white p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-4",children:"Something went wrong"}),e.jsx("pre",{className:"bg-black/50 p-4 rounded text-sm overflow-auto max-w-full",children:(l=this.state.error)==null?void 0:l.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700",children:"Reload Game"})]}):this.props.children}}ee.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(Ae,{children:e.jsx($e,{})})}));
