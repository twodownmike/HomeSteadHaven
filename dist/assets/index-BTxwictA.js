import{r as S,z as e,I as C,J as A,K as H,Q as _,X as z,Y as F,Z as U,p as T,R as G,_ as $}from"./vendor-bcaf5DJD.js";import{c as Z,U as J,S as X,R as W,X as K,A as q,T as Q,M as Y,H as V,W as ee,a as te,E as se,B as re,b as oe,V as ne}from"./game-DUihjE3D.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const l of t.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(s){if(s.ep)return;s.ep=!0;const t=r(s);fetch(s.href,t)}})();const ae={};function ie(n,a){let r;try{r=n()}catch{return}return{getItem:s=>{var t;const l=i=>i===null?null:JSON.parse(i,void 0),h=(t=r.getItem(s))!=null?t:null;return h instanceof Promise?h.then(l):l(h)},setItem:(s,t)=>r.setItem(s,JSON.stringify(t,void 0)),removeItem:s=>r.removeItem(s)}}const P=n=>a=>{try{const r=n(a);return r instanceof Promise?r:{then(o){return P(o)(r)},catch(o){return this}}}catch(r){return{then(o){return this},catch(o){return P(o)(r)}}}},le=(n,a)=>(r,o,s)=>{let t={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:x=>x,version:0,merge:(x,d)=>({...d,...x}),...a},l=!1;const h=new Set,i=new Set;let c;try{c=t.getStorage()}catch{}if(!c)return n((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${t.name}', the given storage is currently unavailable.`),r(...x)},o,s);const v=P(t.serialize),j=()=>{const x=t.partialize({...o()});let d;const u=v({state:x,version:t.version}).then(w=>c.setItem(t.name,w)).catch(w=>{d=w});if(d)throw d;return u},b=s.setState;s.setState=(x,d)=>{b(x,d),j()};const g=n((...x)=>{r(...x),j()},o,s);let m;const p=()=>{var x;if(!c)return;l=!1,h.forEach(u=>u(o()));const d=((x=t.onRehydrateStorage)==null?void 0:x.call(t,o()))||void 0;return P(c.getItem.bind(c))(t.name).then(u=>{if(u)return t.deserialize(u)}).then(u=>{if(u)if(typeof u.version=="number"&&u.version!==t.version){if(t.migrate)return t.migrate(u.state,u.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return u.state}).then(u=>{var w;return m=t.merge(u,(w=o())!=null?w:g),r(m,!0),j()}).then(()=>{d==null||d(m,void 0),l=!0,i.forEach(u=>u(m))}).catch(u=>{d==null||d(void 0,u)})};return s.persist={setOptions:x=>{t={...t,...x},x.getStorage&&(c=x.getStorage())},clearStorage:()=>{c==null||c.removeItem(t.name)},getOptions:()=>t,rehydrate:()=>p(),hasHydrated:()=>l,onHydrate:x=>(h.add(x),()=>{h.delete(x)}),onFinishHydration:x=>(i.add(x),()=>{i.delete(x)})},p(),m||g},ce=(n,a)=>(r,o,s)=>{let t={storage:ie(()=>localStorage),partialize:p=>p,version:0,merge:(p,x)=>({...x,...p}),...a},l=!1;const h=new Set,i=new Set;let c=t.storage;if(!c)return n((...p)=>{console.warn(`[zustand persist middleware] Unable to update item '${t.name}', the given storage is currently unavailable.`),r(...p)},o,s);const v=()=>{const p=t.partialize({...o()});return c.setItem(t.name,{state:p,version:t.version})},j=s.setState;s.setState=(p,x)=>{j(p,x),v()};const b=n((...p)=>{r(...p),v()},o,s);s.getInitialState=()=>b;let g;const m=()=>{var p,x;if(!c)return;l=!1,h.forEach(u=>{var w;return u((w=o())!=null?w:b)});const d=((x=t.onRehydrateStorage)==null?void 0:x.call(t,(p=o())!=null?p:b))||void 0;return P(c.getItem.bind(c))(t.name).then(u=>{if(u)if(typeof u.version=="number"&&u.version!==t.version){if(t.migrate)return[!0,t.migrate(u.state,u.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,u.state];return[!1,void 0]}).then(u=>{var w;const[k,f]=u;if(g=t.merge(f,(w=o())!=null?w:b),r(g,!0),k)return v()}).then(()=>{d==null||d(g,void 0),g=o(),l=!0,i.forEach(u=>u(g))}).catch(u=>{d==null||d(void 0,u)})};return s.persist={setOptions:p=>{t={...t,...p},p.storage&&(c=p.storage)},clearStorage:()=>{c==null||c.removeItem(t.name)},getOptions:()=>t,rehydrate:()=>m(),hasHydrated:()=>l,onHydrate:p=>(h.add(p),()=>{h.delete(p)}),onFinishHydration:p=>(i.add(p),()=>{i.delete(p)})},t.skipHydration||m(),g||b},de=(n,a)=>"getStorage"in a||"serialize"in a||"deserialize"in a?((ae?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),le(n,a)):ce(n,a),ue=de,B={cabin:{wood:10},farm:{wood:20,stone:5},lumberMill:{wood:50,stone:10},mine:{wood:100,stone:50}},E={cabin:{housing:4},farm:{workers:1},lumberMill:{workers:2},mine:{workers:3}},me={cabin:{},farm:{food:5},lumberMill:{wood:5},mine:{stone:2,iron:1}},R=()=>Math.random().toString(36).substr(2,9),I=Z()(ue((n,a)=>({resources:{wood:100,food:50,stone:0,iron:0},population:2,buildings:[],nature:(()=>{const r=[];for(let o=0;o<40;o++){const s=Math.random()*Math.PI*2,t=15+Math.random()*30,l=Math.cos(s)*t,h=Math.sin(s)*t,i=Math.random()>.3?"tree":"rock",c=.8+Math.random()*.5;r.push({id:`nature-${o}`,position:[l,0,h],type:i,scale:c})}return r})(),logs:[],selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,day:1,addLog:(r,o="info")=>{n(s=>({logs:[{id:R(),message:r,timestamp:Date.now(),type:o},...s.logs].slice(0,20)}))},addResource:(r,o)=>n(s=>({resources:{...s.resources,[r]:s.resources[r]+o}})),removeResource:(r,o)=>a().resources[r]>=o?(n(t=>({resources:{...t.resources,[r]:t.resources[r]-o}})),!0):!1,removeNature:r=>{const o=a(),s=o.nature.find(t=>t.id===r);s&&(o.addLog(`Cleared ${s.type}`,"info"),n(t=>({nature:t.nature.filter(l=>l.id!==r)})))},addBuilding:(r,o)=>{const s=a(),t=s.buildings.some(m=>m.position[0]===o[0]&&m.position[2]===o[2]),l=o[0]-.8,h=o[0]+.8,i=o[2]-.8,c=o[2]+.8,v=s.nature.some(m=>m.position[0]>l&&m.position[0]<h&&m.position[2]>i&&m.position[2]<c);if(t||v){s.addLog("Cannot build here!","warning");return}const j=B[r],b=E[r];let g=!0;if(Object.keys(j).forEach(m=>{(s.resources[m]||0)<(j[m]||0)&&(g=!1)}),!g){s.addLog("Not enough resources!","warning");return}if(b.workers){const m=s.buildings.reduce((p,x)=>p+(E[x.type].workers||0),0);if(s.population-m<b.workers){g=!1,s.addLog("Not enough workers!","warning");return}}g&&(Object.keys(j).forEach(m=>{s.removeResource(m,j[m]||0)}),n(m=>({buildings:[...m.buildings,{id:R(),type:r,position:o,level:1,lastCollected:Date.now()}],isBuilding:!1,selectedBuilding:null})),s.addLog(`Built ${r}!`,"success"))},upgradeBuilding:r=>{const o=a(),s=o.buildings.find(i=>i.id===r);if(!s)return;const t=B[s.type],l=s.level+1;let h=!0;Object.keys(t).forEach(i=>{const c=(t[i]||0)*l;(o.resources[i]||0)<c&&(h=!1)}),h?(Object.keys(t).forEach(i=>{const c=(t[i]||0)*l;o.removeResource(i,c)}),n(i=>({buildings:i.buildings.map(c=>c.id===r?{...c,level:c.level+1}:c)})),o.addLog(`Upgraded ${s.type} to level ${s.level+1}`,"success")):o.addLog("Not enough resources to upgrade!","warning")},demolishBuilding:r=>{const o=a(),s=o.buildings.find(t=>t.id===r);s&&(o.addLog(`Demolished ${s.type}`,"danger"),n(t=>({buildings:t.buildings.filter(l=>l.id!==r),selectedBuildingId:null})))},setSelectedBuilding:r=>n({selectedBuilding:r,isBuilding:!!r,selectedBuildingId:null}),selectBuildingId:r=>n({selectedBuildingId:r,selectedBuilding:null,isBuilding:!1}),tick:()=>{n(r=>{const o={...r.resources};let s=r.population;const t=2,l=r.buildings.reduce((v,j)=>v+(E[j.type].housing||0),0),h=t+l,i=.5+r.population*.5;if(o.food>=i){o.food-=i,o.food>i*2&&s<h&&Math.random()<.05&&(s+=1);const v=r.buildings.reduce((b,g)=>b+(E[g.type].workers||0),0),j=v>0?Math.min(1,r.population/v):1;r.buildings.forEach(b=>{const g=me[b.type];g&&Object.keys(g).forEach(m=>{const p=(g[m]||0)*j*b.level;o[m]+=p})})}else o.food=0,Math.random()<.1&&s>1&&(s-=1);let c=[...r.logs];return s>r.population?c=[{id:R(),message:"A new settler arrived!",timestamp:Date.now(),type:"success"},...c].slice(0,20):s<r.population&&(c=[{id:R(),message:"A settler died from starvation!",timestamp:Date.now(),type:"danger"},...c].slice(0,20)),{resources:o,population:s,day:r.day+.005,logs:c}})},reset:()=>{const r=[];for(let o=0;o<40;o++){const s=Math.random()*Math.PI*2,t=15+Math.random()*30,l=Math.cos(s)*t,h=Math.sin(s)*t,i=Math.random()>.3?"tree":"rock",c=.8+Math.random()*.5;r.push({id:`nature-${o}`,position:[l,0,h],type:i,scale:c})}n({resources:{wood:100,food:50,stone:0,iron:0},population:2,buildings:[],nature:r,logs:[],selectedBuilding:null,selectedBuildingId:null,isBuilding:!1,day:1})}}),{name:"homestead-storage",partialize:n=>({resources:n.resources,population:n.population,buildings:n.buildings,nature:n.nature,logs:n.logs,day:n.day})})),he=({type:n})=>{switch(n){case"wood":return e.jsx(te,{className:"w-4 h-4 text-amber-700"});case"food":return e.jsx(ee,{className:"w-4 h-4 text-yellow-600"});case"stone":return e.jsx(V,{className:"w-4 h-4 text-stone-500"});case"iron":return e.jsx(Y,{className:"w-4 h-4 text-slate-400"})}},xe=()=>{const{resources:n,population:a,isBuilding:r,selectedBuilding:o,setSelectedBuilding:s,day:t,reset:l,buildings:h,selectedBuildingId:i,selectBuildingId:c,upgradeBuilding:v,demolishBuilding:j,logs:b}=I(),[g,m]=S.useState(!1),p=f=>{s(o===f&&r?null:f)},x=()=>{confirm("Are you sure you want to reset your progress? This cannot be undone.")&&(l(),m(!1))},d=i?h.find(f=>f.id===i):null,u=d?B[d.type]:null,w=d?d.level+1:1,k=u&&Object.keys(u).every(f=>{const y=f;return n[y]>=(u[y]||0)*w});return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-4",children:[e.jsxs("div",{className:"flex justify-between items-start pointer-events-auto",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex gap-4 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:Object.entries(n).map(([f,y])=>e.jsxs("div",{className:"flex items-center gap-2 min-w-[80px]",children:[e.jsx(he,{type:f}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:f}),e.jsx("span",{className:"font-mono font-bold",children:Math.floor(y)})]})]},f))}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl min-w-[80px]",children:[e.jsx(J,{className:"w-4 h-4 text-blue-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:"Pop"}),e.jsx("span",{className:"font-mono font-bold",children:Math.floor(a)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:e.jsxs("div",{className:"text-sm font-bold",children:["Day ",t.toFixed(1)]})}),e.jsx("button",{onClick:()=>m(!g),className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl hover:bg-white/10 transition-colors",children:e.jsx(X,{className:"w-5 h-5"})})]})]}),g&&e.jsxs("div",{className:"absolute top-20 right-4 bg-black/80 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl pointer-events-auto z-50 flex flex-col gap-2 min-w-[200px]",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Settings"}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/40 text-red-200 px-4 py-2 rounded-lg transition-colors w-full text-left",children:[e.jsx(W,{className:"w-4 h-4"}),"Reset Progress"]}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"v0.1.0 Alpha"})]}),e.jsx("div",{className:"absolute bottom-32 left-4 flex flex-col gap-2 w-[300px] pointer-events-none opacity-80",children:b.slice(0,5).map(f=>e.jsx("div",{className:`
                    p-2 rounded-lg text-sm font-medium backdrop-blur-md shadow-lg border border-white/5 animate-in slide-in-from-left-4 fade-in duration-300
                    ${f.type==="success"?"bg-green-900/60 text-green-100":f.type==="warning"?"bg-yellow-900/60 text-yellow-100":f.type==="danger"?"bg-red-900/60 text-red-100":"bg-gray-900/60 text-gray-100"}
                `,children:f.message},f.id))}),d&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-md p-6 rounded-2xl border border-white/10 text-white shadow-2xl pointer-events-auto z-40 min-w-[300px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl capitalize",children:d.type}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Level ",d.level]})]}),e.jsx("button",{onClick:()=>c(null),className:"text-gray-400 hover:text-white",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>v(d.id),disabled:!k,className:`
                          flex items-center justify-between p-3 rounded-xl border border-white/10 transition-all
                          ${k?"bg-green-600/20 hover:bg-green-600/40 border-green-500/50":"bg-gray-800/50 opacity-50 cursor-not-allowed"}
                      `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold",children:"Upgrade"}),e.jsx("div",{className:"text-xs text-gray-300",children:"Increases efficiency"})]})]}),e.jsx("div",{className:"flex flex-col items-end text-xs",children:u&&Object.entries(u).map(([f,y])=>e.jsxs("div",{className:n[f]<y*w?"text-red-400":"text-gray-300",children:[y*w," ",f.charAt(0).toUpperCase()]},f))})]}),e.jsxs("button",{onClick:()=>j(d.id),className:"flex items-center gap-2 p-3 rounded-xl bg-red-500/10 hover:bg-red-500/30 border border-red-500/30 text-red-200 transition-colors",children:[e.jsx(Q,{className:"w-5 h-5"}),"Demolish Building"]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4 pointer-events-auto mb-4 w-full px-4",children:[r&&e.jsxs("div",{className:"bg-black/80 text-white px-6 py-3 rounded-full text-base animate-pulse border border-yellow-500/50 shadow-lg",children:["Placing ",o,"... (Tap to build)"]}),e.jsx("div",{className:"flex gap-3 bg-black/80 backdrop-blur-md p-3 rounded-2xl border border-white/10 shadow-2xl overflow-x-auto w-full max-w-full scrollbar-hide",children:Object.keys(B).map(f=>{const y=B[f],L=o===f,N=Object.keys(y).every(M=>n[M]>=(y[M]||0));return e.jsxs("button",{onClick:()=>p(f),disabled:!N,className:`
                  relative group flex flex-col items-center gap-2 p-4 rounded-xl transition-all duration-200 min-w-[110px] flex-shrink-0
                  ${L?"bg-yellow-600 text-white ring-2 ring-yellow-400":"bg-white/5 hover:bg-white/10 text-gray-300"}
                  ${N?"active:scale-95":"opacity-50 cursor-not-allowed grayscale"}
                `,children:[e.jsx("span",{className:"capitalize font-bold text-sm md:text-base",children:f.replace(/([A-Z])/g," $1").trim()}),e.jsx("div",{className:"flex gap-2 text-xs",children:Object.entries(y).map(([M,O])=>e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:n[M]<O?"text-red-400":"text-gray-400",children:[O," ",M.charAt(0).toUpperCase()]})},M))})]},f)})})]})]})},D=({type:n,level:a=1,selected:r,ghost:o,isValid:s=!0,onClick:t})=>{const l=S.useMemo(()=>{if(o&&!s)return"#ff0000";switch(n){case"cabin":return"#8B4513";case"farm":return"#DAA520";case"lumberMill":return"#556B2F";case"mine":return"#696969";default:return"#ffffff"}},[n,o,s]),h=o?.5:1,i=o;return e.jsxs("group",{onClick:t,children:[e.jsxs("mesh",{position:[0,1,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[2,2,2]}),e.jsx("meshStandardMaterial",{color:l,transparent:i,opacity:h})]}),(n==="cabin"||n==="farm")&&e.jsxs("mesh",{position:[0,2.5,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1.6,1.5,4]}),e.jsx("meshStandardMaterial",{color:"#4A3B2C",transparent:i,opacity:h})]}),n==="mine"&&e.jsxs("mesh",{position:[.8,.5,.8],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"#2F2F2F",transparent:i,opacity:h})]}),n==="lumberMill"&&e.jsxs("mesh",{position:[0,2.2,0],rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.8,.8,2.2,8]}),e.jsx("meshStandardMaterial",{color:"#DEB887",transparent:i,opacity:h})]}),r&&!o&&e.jsxs("mesh",{position:[0,.1,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[1.5,1.7,32]}),e.jsx("meshBasicMaterial",{color:"#00ff00"})]}),!o&&e.jsx(C,{position:[0,3,0],center:!0,distanceFactor:15,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap",children:["Lvl ",a]})})]})},pe=({id:n,position:a,scale:r=1})=>{const{addResource:o,removeNature:s,isBuilding:t}=I(),[l,h]=S.useState(!1),[i,c]=S.useState(0),[v,j]=S.useState(0),b=g=>{g.stopPropagation(),o("wood",10),c(Date.now());const m=v+1;j(m),m>=5&&s(n)};return e.jsxs("group",{position:a,scale:[r*(l?1.1:1),r*(l?1.1:1),r*(l?1.1:1)],onPointerOver:()=>h(!0),onPointerOut:()=>h(!1),onClick:b,children:[e.jsxs("mesh",{position:[0,.75,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.2,.3,1.5,6]}),e.jsx("meshStandardMaterial",{color:l?"#6d4c3d":"#5C4033"})]}),e.jsxs("mesh",{position:[0,2,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1,2,8]}),e.jsx("meshStandardMaterial",{color:l?"#2e8b2e":"#228B22"})]}),e.jsxs("mesh",{position:[0,3,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.8,1.5,8]}),e.jsx("meshStandardMaterial",{color:l?"#2e8b2e":"#228B22"})]}),l&&!t&&e.jsx(C,{position:[0,4,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Wood (+10)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-v," more to clear)"]})]})}),Date.now()-i<1e3&&e.jsx(C,{position:[0,2,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-green-400 font-bold text-sm animate-bounce pointer-events-none",children:"+10 Wood"})})]})},fe=({id:n,position:a,scale:r=1})=>{const{addResource:o,removeNature:s,isBuilding:t}=I(),[l,h]=S.useState(!1),[i,c]=S.useState(0),[v,j]=S.useState(0),b=g=>{g.stopPropagation(),o("stone",5),Math.random()>.7&&o("iron",2),c(Date.now());const m=v+1;j(m),m>=5&&s(n)};return e.jsxs("group",{position:a,scale:[r*(l?1.1:1),r*(l?1.1:1),r*(l?1.1:1)],rotation:[0,Math.random()*Math.PI,0],onPointerOver:()=>h(!0),onPointerOut:()=>h(!1),onClick:b,children:[e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[.8,0]}),e.jsx("meshStandardMaterial",{color:l?"#909090":"#808080",flatShading:!0})]}),l&&!t&&e.jsx(C,{position:[0,1.5,0],center:!0,distanceFactor:10,children:e.jsxs("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none flex flex-col items-center",children:[e.jsx("span",{children:"Gather Stone (+5)"}),e.jsxs("span",{className:"text-[10px] text-gray-300",children:["(",5-v," more to clear)"]})]})}),Date.now()-i<1e3&&e.jsx(C,{position:[0,1,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-gray-300 font-bold text-sm animate-bounce pointer-events-none",children:"+5 Stone"})})]})},ge=()=>{const n=I(a=>a.nature);return e.jsx("group",{children:n.map(a=>a.type==="tree"?e.jsx(pe,{id:a.id,position:a.position,scale:a.scale},a.id):e.jsx(fe,{id:a.id,position:a.position,scale:a.scale},a.id))})},be=()=>{const{buildings:n,nature:a,selectedBuilding:r,selectedBuildingId:o,isBuilding:s,addBuilding:t,selectBuildingId:l,setSelectedBuilding:h}=I(),[i,c]=S.useState(null),[v,j]=S.useState(!0),b=2,g=d=>{if(n.some(N=>N.position[0]===d[0]&&N.position[2]===d[2]))return!0;const w=d[0]-.8,k=d[0]+.8,f=d[2]-.8,y=d[2]+.8;return a.some(N=>N.position[0]>w&&N.position[0]<k&&N.position[2]>f&&N.position[2]<y)},m=d=>{if(!s||!r){i&&c(null);return}const u=Math.round(d.point.x/b)*b,w=Math.round(d.point.z/b)*b,k=[u,0,w];(!i||i[0]!==u||i[2]!==w)&&(c(k),j(!g(k)))},p=d=>{s&&r&&i?(d.stopPropagation(),v&&t(r,i)):(l(null),h(null))},x=(d,u)=>{s||(d.stopPropagation(),l(u))};return e.jsxs("group",{children:[e.jsx(ge,{}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,onPointerMove:m,onClick:p,children:[e.jsx("planeGeometry",{args:[100,100]}),e.jsx("meshStandardMaterial",{color:"#5C8C46"})]}),e.jsx("gridHelper",{args:[100,50,16777215,16777215],position:[0,.01,0],"material-opacity":.2,"material-transparent":!0}),n.map(d=>e.jsx("group",{position:d.position,children:e.jsx(D,{type:d.type,level:d.level,selected:o===d.id,onClick:u=>x(u,d.id)})},d.id)),s&&r&&i&&e.jsx("group",{position:i,children:e.jsx(D,{type:r,ghost:!0,isValid:v})})]})},ve=()=>{const n=I(a=>a.tick);return S.useEffect(()=>{const a=setInterval(()=>{n()},1e3);return()=>clearInterval(a)},[n]),null},je=()=>{const n=I(i=>i.day),a=S.useRef(null),r=n%1,o=[Math.sin(r*Math.PI*2)*100,Math.cos(r*Math.PI*2+Math.PI)*100,20],s=o[1]/100,t=Math.max(0,s),l=Math.max(.1,t*.5),h=t>.2?"#87CEEB":"#050510";return e.jsxs(e.Fragment,{children:[e.jsx(A,{sunPosition:o,turbidity:.5,rayleigh:.5+(1-t)*.5,mieCoefficient:.005,mieDirectionalG:.7}),t<.2&&e.jsx(H,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1}),t<.3&&e.jsx(_,{count:100,scale:50,size:4,speed:.4,opacity:.7,color:"#ffff00",position:[0,5,0]}),e.jsx(z,{preset:"forest",background:!1}),e.jsx("ambientLight",{intensity:l,color:t<.2?"#1a1a2e":"#ffffff"}),e.jsx("directionalLight",{ref:a,position:o,intensity:t*2,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4,children:e.jsx("orthographicCamera",{attach:"shadow-camera",args:[-50,50,50,-50]})}),e.jsx("fog",{attach:"fog",args:[h,10,80]})]})};function we(){return e.jsxs("div",{className:"relative w-full h-full bg-slate-900 touch-none",children:[e.jsx(ve,{}),e.jsx(F,{shadows:!0,camera:{position:[20,20,20],fov:50},dpr:[1,2],gl:{antialias:!1},children:e.jsxs(S.Suspense,{fallback:e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"orange",wireframe:!0})]}),children:[e.jsx(je,{}),e.jsx(be,{}),e.jsx(U,{makeDefault:!0,maxPolarAngle:Math.PI/2.2,minDistance:10,maxDistance:80,enableDamping:!0,dampingFactor:.05}),e.jsxs(se,{children:[e.jsx(re,{luminanceThreshold:1,mipmapBlur:!0,intensity:.5}),e.jsx(oe,{}),e.jsx(ne,{eskil:!1,offset:.1,darkness:.5})]})]})}),e.jsx(xe,{})]})}console.log("Homestead Survival: Initializing...");console.log("Three.js Revision:",T);class ye extends G.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("Uncaught error:",a,r)}render(){var a;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-900 text-white p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-4",children:"Something went wrong"}),e.jsx("pre",{className:"bg-black/50 p-4 rounded text-sm overflow-auto max-w-full",children:(a=this.state.error)==null?void 0:a.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700",children:"Reload Game"})]}):this.props.children}}$.createRoot(document.getElementById("root")).render(e.jsx(G.StrictMode,{children:e.jsx(ye,{children:e.jsx(we,{})})}));
