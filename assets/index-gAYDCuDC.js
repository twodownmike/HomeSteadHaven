import{r as j,j as e,H as S,S as C,a as P,b as B,E as G,C as O,O as _,c as H,R as k,d as D}from"./vendor-BqKG48Gq.js";import{c as F,S as z,R as L,M as A,H as T,W as U,T as J}from"./game-CziOy4gz.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(r){if(r.ep)return;r.ep=!0;const t=o(r);fetch(r.href,t)}})();const $={};function W(a,s){let o;try{o=a()}catch{return}return{getItem:r=>{var t;const i=m=>m===null?null:JSON.parse(m,void 0),l=(t=o.getItem(r))!=null?t:null;return l instanceof Promise?l.then(i):i(l)},setItem:(r,t)=>o.setItem(r,JSON.stringify(t,void 0)),removeItem:r=>o.removeItem(r)}}const N=a=>s=>{try{const o=a(s);return o instanceof Promise?o:{then(n){return N(n)(o)},catch(n){return this}}}catch(o){return{then(n){return this},catch(n){return N(n)(o)}}}},Z=(a,s)=>(o,n,r)=>{let t={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:d=>d,version:0,merge:(d,f)=>({...f,...d}),...s},i=!1;const l=new Set,m=new Set;let h;try{h=t.getStorage()}catch{}if(!h)return a((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${t.name}', the given storage is currently unavailable.`),o(...d)},n,r);const x=N(t.serialize),g=()=>{const d=t.partialize({...n()});let f;const c=x({state:d,version:t.version}).then(v=>h.setItem(t.name,v)).catch(v=>{f=v});if(f)throw f;return c},w=r.setState;r.setState=(d,f)=>{w(d,f),g()};const b=a((...d)=>{o(...d),g()},n,r);let p;const u=()=>{var d;if(!h)return;i=!1,l.forEach(c=>c(n()));const f=((d=t.onRehydrateStorage)==null?void 0:d.call(t,n()))||void 0;return N(h.getItem.bind(h))(t.name).then(c=>{if(c)return t.deserialize(c)}).then(c=>{if(c)if(typeof c.version=="number"&&c.version!==t.version){if(t.migrate)return t.migrate(c.state,c.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return c.state}).then(c=>{var v;return p=t.merge(c,(v=n())!=null?v:b),o(p,!0),g()}).then(()=>{f==null||f(p,void 0),i=!0,m.forEach(c=>c(p))}).catch(c=>{f==null||f(void 0,c)})};return r.persist={setOptions:d=>{t={...t,...d},d.getStorage&&(h=d.getStorage())},clearStorage:()=>{h==null||h.removeItem(t.name)},getOptions:()=>t,rehydrate:()=>u(),hasHydrated:()=>i,onHydrate:d=>(l.add(d),()=>{l.delete(d)}),onFinishHydration:d=>(m.add(d),()=>{m.delete(d)})},u(),p||b},q=(a,s)=>(o,n,r)=>{let t={storage:W(()=>localStorage),partialize:u=>u,version:0,merge:(u,d)=>({...d,...u}),...s},i=!1;const l=new Set,m=new Set;let h=t.storage;if(!h)return a((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${t.name}', the given storage is currently unavailable.`),o(...u)},n,r);const x=()=>{const u=t.partialize({...n()});return h.setItem(t.name,{state:u,version:t.version})},g=r.setState;r.setState=(u,d)=>{g(u,d),x()};const w=a((...u)=>{o(...u),x()},n,r);r.getInitialState=()=>w;let b;const p=()=>{var u,d;if(!h)return;i=!1,l.forEach(c=>{var v;return c((v=n())!=null?v:w)});const f=((d=t.onRehydrateStorage)==null?void 0:d.call(t,(u=n())!=null?u:w))||void 0;return N(h.getItem.bind(h))(t.name).then(c=>{if(c)if(typeof c.version=="number"&&c.version!==t.version){if(t.migrate)return[!0,t.migrate(c.state,c.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,c.state];return[!1,void 0]}).then(c=>{var v;const[R,E]=c;if(b=t.merge(E,(v=n())!=null?v:w),o(b,!0),R)return x()}).then(()=>{f==null||f(b,void 0),b=n(),i=!0,m.forEach(c=>c(b))}).catch(c=>{f==null||f(void 0,c)})};return r.persist={setOptions:u=>{t={...t,...u},u.storage&&(h=u.storage)},clearStorage:()=>{h==null||h.removeItem(t.name)},getOptions:()=>t,rehydrate:()=>p(),hasHydrated:()=>i,onHydrate:u=>(l.add(u),()=>{l.delete(u)}),onFinishHydration:u=>(m.add(u),()=>{m.delete(u)})},t.skipHydration||p(),b||w},K=(a,s)=>"getStorage"in s||"serialize"in s||"deserialize"in s?(($?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Z(a,s)):q(a,s),Q=K,M={cabin:{wood:10},farm:{wood:20,stone:5},lumberMill:{wood:50,stone:10},mine:{wood:100,stone:50}},X={cabin:{},farm:{food:5},lumberMill:{wood:5},mine:{stone:2,iron:1}},Y=()=>Math.random().toString(36).substr(2,9),y=F()(Q((a,s)=>({resources:{wood:100,food:50,stone:0,iron:0},buildings:[],selectedBuilding:null,isBuilding:!1,day:1,addResource:(o,n)=>a(r=>({resources:{...r.resources,[o]:r.resources[o]+n}})),removeResource:(o,n)=>s().resources[o]>=n?(a(t=>({resources:{...t.resources,[o]:t.resources[o]-n}})),!0):!1,addBuilding:(o,n)=>{const r=s(),t=M[o];let i=!0;Object.keys(t).forEach(l=>{(r.resources[l]||0)<(t[l]||0)&&(i=!1)}),i&&(Object.keys(t).forEach(l=>{r.removeResource(l,t[l]||0)}),a(l=>({buildings:[...l.buildings,{id:Y(),type:o,position:n,level:1,lastCollected:Date.now()}],isBuilding:!1,selectedBuilding:null})))},setSelectedBuilding:o=>a({selectedBuilding:o,isBuilding:!!o}),tick:()=>{a(o=>{const n={...o.resources},r=.5+o.buildings.length*.2;return n.food>=r?(n.food-=r,o.buildings.forEach(t=>{const i=X[t.type];i&&Object.keys(i).forEach(l=>{n[l]+=i[l]||0})})):n.food=0,{resources:n,day:o.day+.005}})},reset:()=>{a({resources:{wood:100,food:50,stone:0,iron:0},buildings:[],selectedBuilding:null,isBuilding:!1,day:1})}}),{name:"homestead-storage",partialize:a=>({resources:a.resources,buildings:a.buildings,day:a.day})})),V=({type:a})=>{switch(a){case"wood":return e.jsx(J,{className:"w-4 h-4 text-amber-700"});case"food":return e.jsx(U,{className:"w-4 h-4 text-yellow-600"});case"stone":return e.jsx(T,{className:"w-4 h-4 text-stone-500"});case"iron":return e.jsx(A,{className:"w-4 h-4 text-slate-400"})}},ee=()=>{const{resources:a,isBuilding:s,selectedBuilding:o,setSelectedBuilding:n,day:r,reset:t}=y(),[i,l]=j.useState(!1),m=x=>{n(o===x&&s?null:x)},h=()=>{confirm("Are you sure you want to reset your progress? This cannot be undone.")&&(t(),l(!1))};return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-4",children:[e.jsxs("div",{className:"flex justify-between items-start pointer-events-auto",children:[e.jsx("div",{className:"flex gap-4 bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:Object.entries(a).map(([x,g])=>e.jsxs("div",{className:"flex items-center gap-2 min-w-[80px]",children:[e.jsx(V,{type:x}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase opacity-60 font-bold tracking-wider",children:x}),e.jsx("span",{className:"font-mono font-bold",children:Math.floor(g)})]})]},x))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl",children:e.jsxs("div",{className:"text-sm font-bold",children:["Day ",r.toFixed(1)]})}),e.jsx("button",{onClick:()=>l(!i),className:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white shadow-xl hover:bg-white/10 transition-colors",children:e.jsx(z,{className:"w-5 h-5"})})]})]}),i&&e.jsxs("div",{className:"absolute top-20 right-4 bg-black/80 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl pointer-events-auto z-50 flex flex-col gap-2 min-w-[200px]",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Settings"}),e.jsxs("button",{onClick:h,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/40 text-red-200 px-4 py-2 rounded-lg transition-colors w-full text-left",children:[e.jsx(L,{className:"w-4 h-4"}),"Reset Progress"]}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"v0.1.0 Alpha"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4 pointer-events-auto mb-4 w-full px-4",children:[s&&e.jsxs("div",{className:"bg-black/80 text-white px-6 py-3 rounded-full text-base animate-pulse border border-yellow-500/50 shadow-lg",children:["Placing ",o,"... (Tap to build)"]}),e.jsx("div",{className:"flex gap-3 bg-black/80 backdrop-blur-md p-3 rounded-2xl border border-white/10 shadow-2xl overflow-x-auto w-full max-w-full scrollbar-hide",children:Object.keys(M).map(x=>{const g=M[x],w=o===x,b=Object.keys(g).every(p=>a[p]>=(g[p]||0));return e.jsxs("button",{onClick:()=>m(x),disabled:!b,className:`
                  relative group flex flex-col items-center gap-2 p-4 rounded-xl transition-all duration-200 min-w-[110px] flex-shrink-0
                  ${w?"bg-yellow-600 text-white ring-2 ring-yellow-400":"bg-white/5 hover:bg-white/10 text-gray-300"}
                  ${b?"active:scale-95":"opacity-50 cursor-not-allowed grayscale"}
                `,children:[e.jsx("span",{className:"capitalize font-bold text-sm md:text-base",children:x.replace(/([A-Z])/g," $1").trim()}),e.jsx("div",{className:"flex gap-2 text-xs",children:Object.entries(g).map(([p,u])=>e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:a[p]<u?"text-red-400":"text-gray-400",children:[u," ",p.charAt(0).toUpperCase()]})},p))})]},x)})})]})]})},I=({type:a,selected:s,ghost:o})=>{const n=j.useMemo(()=>{switch(a){case"cabin":return"#8B4513";case"farm":return"#DAA520";case"lumberMill":return"#556B2F";case"mine":return"#696969";default:return"#ffffff"}},[a]),r=o?.5:1,t=o;return e.jsxs("group",{children:[e.jsxs("mesh",{position:[0,1,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[2,2,2]}),e.jsx("meshStandardMaterial",{color:n,transparent:t,opacity:r})]}),(a==="cabin"||a==="farm")&&e.jsxs("mesh",{position:[0,2.5,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1.6,1.5,4]}),e.jsx("meshStandardMaterial",{color:"#4A3B2C",transparent:t,opacity:r})]}),a==="mine"&&e.jsxs("mesh",{position:[.8,.5,.8],castShadow:!0,children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"#2F2F2F",transparent:t,opacity:r})]}),a==="lumberMill"&&e.jsxs("mesh",{position:[0,2.2,0],rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.8,.8,2.2,8]}),e.jsx("meshStandardMaterial",{color:"#DEB887",transparent:t,opacity:r})]}),s&&!o&&e.jsxs("mesh",{position:[0,.1,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[1.5,1.7,32]}),e.jsx("meshBasicMaterial",{color:"#00ff00"})]}),!o&&e.jsx(S,{position:[0,3,0],center:!0,distanceFactor:15,children:e.jsx("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap",children:"Lvl 1"})})]})},te=({position:a,scale:s=1})=>{const o=y(m=>m.addResource),[n,r]=j.useState(!1),[t,i]=j.useState(0),l=m=>{m.stopPropagation(),o("wood",10),i(Date.now())};return e.jsxs("group",{position:a,scale:[s*(n?1.1:1),s*(n?1.1:1),s*(n?1.1:1)],onPointerOver:()=>r(!0),onPointerOut:()=>r(!1),onClick:l,children:[e.jsxs("mesh",{position:[0,.75,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.2,.3,1.5,6]}),e.jsx("meshStandardMaterial",{color:n?"#6d4c3d":"#5C4033"})]}),e.jsxs("mesh",{position:[0,2,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1,2,8]}),e.jsx("meshStandardMaterial",{color:n?"#2e8b2e":"#228B22"})]}),e.jsxs("mesh",{position:[0,3,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.8,1.5,8]}),e.jsx("meshStandardMaterial",{color:n?"#2e8b2e":"#228B22"})]}),n&&e.jsx(S,{position:[0,4,0],center:!0,distanceFactor:10,children:e.jsx("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none",children:"Click to Gather Wood"})}),Date.now()-t<1e3&&e.jsx(S,{position:[0,2,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-green-400 font-bold text-sm animate-bounce pointer-events-none",children:"+10 Wood"})})]})},re=({position:a,scale:s=1})=>{const o=y(m=>m.addResource),[n,r]=j.useState(!1),[t,i]=j.useState(0),l=m=>{m.stopPropagation(),o("stone",5),Math.random()>.7&&o("iron",2),i(Date.now())};return e.jsxs("group",{position:a,scale:[s*(n?1.1:1),s*(n?1.1:1),s*(n?1.1:1)],rotation:[0,Math.random()*Math.PI,0],onPointerOver:()=>r(!0),onPointerOut:()=>r(!1),onClick:l,children:[e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[.8,0]}),e.jsx("meshStandardMaterial",{color:n?"#909090":"#808080",flatShading:!0})]}),n&&e.jsx(S,{position:[0,1.5,0],center:!0,distanceFactor:10,children:e.jsx("div",{className:"bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap pointer-events-none",children:"Click to Gather Stone"})}),Date.now()-t<1e3&&e.jsx(S,{position:[0,1,0],center:!0,distanceFactor:10,zIndexRange:[100,0],children:e.jsx("div",{className:"text-gray-300 font-bold text-sm animate-bounce pointer-events-none",children:"+5 Stone"})})]})},se=()=>{const a=j.useMemo(()=>{const s=[];for(let o=0;o<40;o++){const n=Math.random()*Math.PI*2,r=15+Math.random()*30,t=Math.cos(n)*r,i=Math.sin(n)*r,l=Math.random()>.3?"tree":"rock",m=.8+Math.random()*.5;s.push({id:o,x:t,z:i,type:l,scale:m})}return s},[]);return e.jsx("group",{children:a.map(s=>s.type==="tree"?e.jsx(te,{position:[s.x,0,s.z],scale:s.scale},s.id):e.jsx(re,{position:[s.x,.4,s.z],scale:s.scale},s.id))})},oe=()=>{const{buildings:a,selectedBuilding:s,isBuilding:o,addBuilding:n}=y(),[r,t]=j.useState(null),i=2,l=h=>{if(!o||!s){r&&t(null);return}const x=Math.round(h.point.x/i)*i,g=Math.round(h.point.z/i)*i;(!r||r[0]!==x||r[2]!==g)&&t([x,0,g])},m=h=>{o&&s&&r&&(h.stopPropagation(),n(s,r))};return e.jsxs("group",{children:[e.jsx(se,{}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,onPointerMove:l,onClick:m,children:[e.jsx("planeGeometry",{args:[100,100]}),e.jsx("meshStandardMaterial",{color:"#5C8C46"})]}),e.jsx("gridHelper",{args:[100,50,16777215,16777215],position:[0,.01,0],"material-opacity":.2,"material-transparent":!0}),a.map(h=>e.jsx("group",{position:h.position,children:e.jsx(I,{type:h.type})},h.id)),o&&s&&r&&e.jsx("group",{position:r,children:e.jsx(I,{type:s,ghost:!0})})]})},ne=()=>{const a=y(s=>s.tick);return j.useEffect(()=>{const s=setInterval(()=>{a()},1e3);return()=>clearInterval(s)},[a]),null},ae=()=>{const a=y(m=>m.day),s=j.useRef(null),o=a%1,n=[Math.sin(o*Math.PI*2)*100,Math.cos(o*Math.PI*2+Math.PI)*100,20],r=n[1]/100,t=Math.max(0,r),i=Math.max(.1,t*.5),l=t>.2?"#87CEEB":"#050510";return e.jsxs(e.Fragment,{children:[e.jsx(C,{sunPosition:n,turbidity:.5,rayleigh:.5+(1-t)*.5,mieCoefficient:.005,mieDirectionalG:.7}),t<.2&&e.jsx(P,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1}),t<.3&&e.jsx(B,{count:100,scale:50,size:4,speed:.4,opacity:.7,color:"#ffff00",position:[0,5,0]}),e.jsx(G,{preset:"forest",background:!1}),e.jsx("ambientLight",{intensity:i,color:t<.2?"#1a1a2e":"#ffffff"}),e.jsx("directionalLight",{ref:s,position:n,intensity:t*2,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4,children:e.jsx("orthographicCamera",{attach:"shadow-camera",args:[-50,50,50,-50]})}),e.jsx("fog",{attach:"fog",args:[l,10,80]})]})};function ie(){return e.jsxs("div",{className:"relative w-full h-full bg-slate-900 touch-none",children:[e.jsx(ne,{}),e.jsx(O,{shadows:!0,camera:{position:[20,20,20],fov:50},dpr:[1,2],gl:{antialias:!1},children:e.jsxs(j.Suspense,{fallback:e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[1,1,1]}),e.jsx("meshStandardMaterial",{color:"orange",wireframe:!0})]}),children:[e.jsx(ae,{}),e.jsx(oe,{}),e.jsx(_,{makeDefault:!0,maxPolarAngle:Math.PI/2.2,minDistance:10,maxDistance:80,enableDamping:!0,dampingFactor:.05})]})}),e.jsx(ee,{})]})}console.log("Homestead Survival: Initializing...");console.log("Three.js Revision:",H);class le extends k.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,o){console.error("Uncaught error:",s,o)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-900 text-white p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-4",children:"Something went wrong"}),e.jsx("pre",{className:"bg-black/50 p-4 rounded text-sm overflow-auto max-w-full",children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700",children:"Reload Game"})]}):this.props.children}}D.createRoot(document.getElementById("root")).render(e.jsx(k.StrictMode,{children:e.jsx(le,{children:e.jsx(ie,{})})}));
